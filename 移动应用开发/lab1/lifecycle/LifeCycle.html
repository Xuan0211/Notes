<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>LifeCycle - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="LifeCycle" class="main-title"></div></div></header><article><h2 id="cEZUzpR9Ej3gkvaRdAGgXx" class="wolai-block"><span class="inline-wrap">背景</span></h2><div id="E84YAr4XPPgtu4y1C3gqC" class="wolai-block wolai-text"><div><span class="inline-wrap">一次需要监控</span><span class="inline-wrap"><a href="https://developer.android.com/guide/components/activities/activity-lifecycle?hl=zh-cn#alc"><span>Activity 生命周期</span></a></span><span class="inline-wrap">的实验。</span></div></div><div id="gYCXWBhr1vACj7X8N5RNe" class="wolai-file-block wolai-block"><div class="file-icon" style="background-image: url(&quot;data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; width=&apos;24&apos; height=&apos;24&apos; viewBox=&apos;0 0 24 24&apos;%3E%3Cg fill=&apos;none&apos; fill-rule=&apos;evenodd&apos;%3E%3Cpath d=&apos;M12.4 1.5a1.6 1.6 0 011.593 1.454L14 3.1v2.4a2 2 0 001.85 1.995L16 7.5h2.4a1.6 1.6 0 011.593 1.454L20 9.1l-.001 11.424-.004.125A2 2 0 0118 22.5H6a2 2 0 01-2-2v-17a2 2 0 012-2h6.4zm2.58 1.283l3.74 3.736a2.626 2.626 0 00-.32-.019H16a1 1 0 01-1-1V3.1c0-.107-.007-.213-.02-.317z&apos; fill=&apos;%23FA0F00&apos;%3E%3C/path%3E%3Cpath d=&apos;M17.533 14.758c-.832-.885-3.135-.525-3.675-.435-.795-.772-1.35-1.687-1.537-2.025.3-.855.495-1.762.525-2.655 0-.81-.323-1.68-1.223-1.68a.912.912 0 00-.757.443c-.383.66-.233 2.025.382 3.405-.36 1.012-.877 2.475-1.56 3.66-.922.367-2.88 1.267-3.067 2.265a.842.842 0 00.27.795c.217.195.502.292.795.285 1.177 0 2.355-1.635 3.15-3.038.667-.232 1.732-.54 2.805-.735 1.245 1.088 2.355 1.253 2.917 1.253.765 0 1.05-.33 1.155-.608a.937.937 0 00-.18-.93zm-.81.57c-.037.218-.315.435-.832.323a4.165 4.165 0 01-1.635-.825c.405-.068 1.35-.158 2.017-.03.24.045.518.18.45.532zm-5.37-6.637a.301.301 0 01.263-.165c.285 0 .345.345.345.63a8.759 8.759 0 01-.375 2.002c-.48-1.275-.413-2.16-.233-2.467zm-.067 6.232c.255-.502.615-1.417.742-1.785a9.452 9.452 0 001.02 1.335 16.87 16.87 0 00-1.762.45zm-1.883 1.29c-.757 1.215-1.5 1.98-1.935 1.98a.308.308 0 01-.195-.067.28.28 0 01-.097-.278c.082-.435.945-1.065 2.227-1.635z&apos; fill=&apos;%23FFF&apos; fill-rule=&apos;nonzero&apos;%3E%3C/path%3E%3C/g%3E%3C/svg%3E&quot;);"></div><a href="media/%E3%80%8A%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E3%80%8B%E5%AE%9E%E9%AA%8C%E6%8C%87%E5%AF%BC%E4%B9%A6%EF%BC%88%E5%AE%9E%E9%AA%8C1%EF%BC%89.pdf"><span>《移动应用开发》实验指导书（实验1）.pdf</span><span data-size="374.84 kB" class="file-size"></span></a></div><div id="gGfFXfhvZ8xPEAoGHjqKVZ" class="wolai-block wolai-text"><div><span class="inline-wrap">如果你认真的阅读了官方文档关于</span><span class="inline-wrap"><a href="https://developer.android.com/guide/components/activities/activity-lifecycle?hl=zh-cn#alc"><span>生命周期</span></a></span><span class="inline-wrap">的描述，就会发现这句话</span></div></div><blockquote id="vsSuUV4w1kamDVnutdLpjj" class="wolai-block"><span class="inline-wrap">如需了解有关处理生命周期的信息（包括最佳做法的相关指导），请参阅</span><span class="inline-wrap"><a href="https://developer.android.com/topic/libraries/architecture/lifecycle?hl=zh-cn"><span>使用生命周期感知型组件处理生命周期</span></a></span><span class="inline-wrap">和</span><span class="inline-wrap"><a href="https://developer.android.com/topic/libraries/architecture/saving-states?hl=zh-cn"><span>保存界面状态</span></a></span><span class="inline-wrap">。如需了解如何将 Activity 与架构组件结合使用，以构建生产质量的稳健应用，请参阅</span><span class="inline-wrap"><a href="https://developer.android.com/topic/libraries/architecture/guide?hl=zh-cn"><span>应用架构指南</span></a></span></blockquote><div id="55tRJVn5cbPmTh3jsSFVQw" class="wolai-block wolai-text"><div><span class="inline-wrap">顺藤摸瓜，就可以打开<span class="jill"></span>Android</span><span class="inline-wrap"><b><code>生命周期感知型组件</code></b></span><span class="inline-wrap">的大门。</span></div></div><h2 id="nB17brPwVtfLRoFt9j59Xp" class="wolai-block"><span class="inline-wrap">总体介绍</span></h2><div id="bEnhm2o1iJkhbTC5RAbFJv" class="wolai-bookmark wolai-block"><a href="https://developer.android.com/topic/libraries/architecture/lifecycle?hl=zh-cn">https://developer.android.com/topic/libraries/architecture/lifecycle?hl=zh-cn</a><div class="info-box"><div class="text-pane"><div data-title="developer.android.com"></div><div class="icon-host"><div data-hostname="developer.android.com"></div></div></div><div class="preview-pane"></div></div></div><div id="8mvqdiXgQu7UEKBUvrC6Fs" class="wolai-block wolai-text"><div><span class="inline-wrap">安卓封装了一些生命周期感知型组件来处理生命周期 ，其中我们可以使用<span class="jill"></span>lifecycle<span class="jill"></span>来解决这个问题。</span></div></div><h2 id="6S9wVkpsvvDHGDePYSeK1H" class="wolai-block"><span class="inline-wrap">Lifecycle</span></h2><div id="sLzqeFg91x94hp6w5iSMTW" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://developer.android.com/reference/androidx/lifecycle/Lifecycle?hl=zh-cn"><span><code>Lifecycle</code></span></a></span><span class="inline-wrap"> 是一个类，用于存储有关组件（如 activity 或 fragment）的生命周期状态的信息，并允许其他对象观察此状态。</span></div></div><div id="dgdmCGpUCbx1bky4wxLLB5" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://developer.android.com/reference/androidx/lifecycle/Lifecycle?hl=zh-cn"><span><code>Lifecycle</code></span></a></span><span class="inline-wrap"> 使用两种主要枚举跟踪其关联组件的生命周期状态：</span></div></div><div id="cuYoxLWYQq8VUDFSvCCRx" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>事件</b></span></div></div><div id="bTyQbuVQMhrDVrmyHLFpJ9" class="wolai-block wolai-text"><div><span class="inline-wrap">从框架和 </span><span class="inline-wrap"><a href="https://developer.android.com/reference/androidx/lifecycle/Lifecycle?hl=zh-cn"><span><code>Lifecycle</code></span></a></span><span class="inline-wrap"> 类分派的生命周期事件。这些事件映射到 activity 和 fragment 中的回调事件。</span></div></div><div id="vHhhiQr8HXTQyeCxaw6UAL" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>状态</b></span></div></div><div id="8V1rc9dSRzWzXFj2brHzVJ" class="wolai-block wolai-text"><div><span class="inline-wrap">由 </span><span class="inline-wrap"><a href="https://developer.android.com/reference/androidx/lifecycle/Lifecycle?hl=zh-cn"><span><code>Lifecycle</code></span></a></span><span class="inline-wrap"> 对象跟踪的组件的当前状态。</span></div></div><div id="4aBFzsCUaenbiVq1hH8yQs" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://developer.android.com/images/topic/libraries/architecture/lifecycle-states.svg" alt="图 1. 构成 Android activity 生命周期的状态和事件" style="width: 100%"/><figcaption>图 1. 构成 Android activity 生命周期的状态和事件</figcaption></figure></div><div id="eV4HJt8HtVjc14XPZHLV4U" class="wolai-block wolai-text"><div><span class="inline-wrap">您可以将状态看作图中的节点，将事件看作这些节点之间的边。</span></div></div><h2 id="tVtmXW43mjHNWGtnDxwzHt" class="wolai-block"><span class="inline-wrap">Usage</span></h2><div id="8rVjtnJMFwW5tpm1aQxSdm" class="wolai-bookmark wolai-block"><a href="https://juejin.cn/post/6844903784166998023#heading-1">Android生命周期组件Lifecycle使用详解 - 掘金</a><div class="info-box"><div class="text-pane"><div data-title="Android生命周期组件Lifecycle使用详解 - 掘金"></div><div data-desc="2018 年的 Google I/O 大会上，Google 发布了 Android Jetpack，并称其为下一代的 Android 组件，旨在帮助开发者加快应用开发速度。准确来讲，Jetpack 是一系列 Android 软件组件的集合，它包括基础组件、架构组件、行为组件、界…"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/apple-touch-icon.png&quot;)"></div><div data-hostname="juejin.cn"></div></div></div><div class="preview-pane"></div></div></div><div id="vgQmpETy6E4RZ6pVK7zY5J" class="wolai-block wolai-text"><div><span class="inline-wrap">首先搞一个继承自</span><span class="inline-wrap"><code>AppCompatActivity</code></span><span class="inline-wrap">的<span class="jill"></span>Activity<span class="jill"></span>类</span></div></div><code-block id="rW9mPQFrNVxVkPCi5G7c9T" class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivityC</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activityc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></pre></div></code-block><div id="buuH8AsNWRNZtsbDWTSe1K" class="wolai-block wolai-text"><div><span class="bg-fluorescent_yellow inline-wrap"><b>由于<span class="jill"></span>Android<span class="jill"></span>已经大慈大悲的完成了挂载</b></span><span class="inline-wrap">，所以我们可以直接在<span class="jill"></span>Activity<span class="jill"></span>里直接使用</span><span class="inline-wrap"><a href="https://developer.android.com/reference/androidx/lifecycle/LifecycleOwner#getLifecycle()"><span><b><code>getLifecycle</code></b></span></a></span><span class="inline-wrap">来引入一个<span class="jill"></span>lifecycle<span class="jill"></span>的观察器来观察生命周期</span></div></div><code-block id="shn5Ny5cZY6xTfeSgzHsUm" class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token function">getLifecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">myObserver</span><span class="token punctuation">(</span>参数表<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><blockquote id="4CA1eB3mcgvT5cAi4jQQuy" class="wolai-block"><span class="inline-wrap">类可以通过实现 </span><span class="inline-wrap"><a href="https://developer.android.com/reference/androidx/lifecycle/DefaultLifecycleObserver?hl=zh-cn"><span><code>DefaultLifecycleObserver</code></span></a></span><span class="inline-wrap"> 并替换相应的方法（如 </span><span class="inline-wrap"><code>onCreate</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>onStart</code></span><span class="inline-wrap"> 等）来监控组件的生命周期状态。然后，您可以通过调用 </span><span class="inline-wrap"><a href="https://developer.android.com/reference/androidx/lifecycle/Lifecycle?hl=zh-cn"><span><code>Lifecycle</code></span></a></span><span class="inline-wrap"> 类的 </span><span class="inline-wrap"><a href="https://developer.android.com/reference/androidx/lifecycle/Lifecycle?hl=zh-cn#addObserver(androidx.lifecycle.LifecycleObserver)"><span><code>addObserver()</code></span></a></span><span class="inline-wrap"> 方法并传递观察器的实例来添加观察器，如下例所示：</span><code-block id="a42Fsbci3BrK5VV9nzkEYx" class="wolai-block"><div class="wolai-pre"><div data-lang="Kotlin" class="marker"></div><pre><span class="token keyword">class</span> MyObserver <span class="token operator">:</span> DefaultLifecycleObserver <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onResume</span><span class="token punctuation">(</span>owner<span class="token operator">:</span> LifecycleOwner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPause</span><span class="token punctuation">(</span>owner<span class="token operator">:</span> LifecycleOwner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

  myLifecycleOwner<span class="token punctuation">.</span><span class="token function">getLifecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token function">MyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></div></code-block><code-block id="riUXAkiUwr1gzAivyCG7D4" class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyObserver</span> <span class="token keyword">implements</span> <span class="token class-name">DefaultLifecycleObserver</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token class-name">LifecycleOwner</span> owner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token class-name">LifecycleOwner</span> owner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

myLifecycleOwner<span class="token punctuation">.</span><span class="token function">getLifecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block></blockquote><h2 id="2ATi2LNsDQDHUdz2cRkHA2" class="wolai-block"><span class="inline-wrap">addObserver</span></h2><div id="w8QtvEc97x2HaFs3miRLM7" class="wolai-block wolai-text"><div><span class="inline-wrap">通过上面我们引用了一个<span class="jill"></span>addObserver<span class="jill"></span>来监控所有的生命周期事件。</span></div></div><blockquote id="wJjQ89Ky4KYwt3RUyXTyWH" class="wolai-block"><span class="inline-wrap">Adds a LifecycleObserver that will be notified when the LifecycleOwner changes state.</span><div id="v6Pg7H9VwwFmtEtC5E47yK" class="wolai-block wolai-text"><div><span class="inline-wrap">The given observer will be brought to the current state of the LifecycleOwner. For example, if the LifecycleOwner is in </span><span class="inline-wrap"><code>[State.STARTED]</code></span><span class="inline-wrap">state, the given observer will receive </span><span class="inline-wrap"><code>Event.ON_CREATE]</code></span><span class="inline-wrap">, </span><span class="inline-wrap"><code>[Event.ON_START]</code></span><span class="inline-wrap"> events.</span></div></div></blockquote><div id="96vM3V4pTdS4AjMnXY7qyS" class="wolai-bookmark wolai-block"><a href="https://developer.android.com/reference/androidx/lifecycle/Lifecycle?spm=wolai.workspace.0.0.4366c9b6XipHWm#addObserver(androidx.lifecycle.LifecycleObserver)">https://developer.android.com/reference/androidx/lifecycle/Lifecycle?spm=wolai.workspace.0.0.4366c9b6XipHWm#addObserver(androidx.lifecycle.LifecycleObserver)</a><div class="info-box"><div class="text-pane"><div data-title="developer.android.com"></div><div class="icon-host"><div data-hostname="developer.android.com"></div></div></div><div class="preview-pane"></div></div></div><h2 id="ngxghpQnL2zRuHeV923be9" class="wolai-block"><span class="inline-wrap">Lifecycle.Event</span></h2><div id="bfwfHdGatJ87F2hSL9VMv" class="wolai-bookmark wolai-block"><a href="https://developer.android.com/reference/androidx/lifecycle/Lifecycle.Event">https://developer.android.com/reference/androidx/lifecycle/Lifecycle.Event</a><div class="info-box"><div class="text-pane"><div data-title="developer.android.com"></div><div class="icon-host"><div data-hostname="developer.android.com"></div></div></div><div class="preview-pane"></div></div></div></article><footer></footer></body></html>