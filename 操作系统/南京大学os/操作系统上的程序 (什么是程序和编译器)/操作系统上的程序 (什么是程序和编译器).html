<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>操作系统上的程序 (什么是程序和编译器) - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="操作系统上的程序 (什么是程序和编译器) " class="main-title"></div></div></header><article><h1 id="hK76yUERGanVg8WmLxvzL5" class="wolai-block"><span class="inline-wrap">数字电路与状态机</span></h1><h2 id="iuZ9sNm6gEksa2cgztsgDx" class="wolai-block"><span class="inline-wrap">数字电路与状态机</span></h2><div id="7bR8AwMDLqsUxwLwSQcjik" class="wolai-block wolai-text"><div><span class="inline-wrap">数字逻辑电路</span></div></div><ul class="wolai-block"><li id="nHrzFQq9GAiGs6YyUwB8mB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">状态 = 寄存器保存的值 (flip-flop)</span></li><li id="wUgvui7UvK8Q62s7bM7CKT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">初始状态 = RESET (implementation dependent)</span></li><li id="7m372rNP7UjPquZx9JhYu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">迁移 = 组合逻辑电路计算寄存器下一周期的值</span></li></ul><hr id="tPQgSuG1dyfuEWNUjM4vf" class="wolai-block"/><div id="crJ6NokW5mUNaTyHrHd22b" class="wolai-block wolai-text"><div><span class="inline-wrap">例子：</span></div></div><div id="342RpMTjawpu2Rn37T2ucU" class="wolai-block wolai-text"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mi>X</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi mathvariant="normal">¬</mi><mi>X</mi><mo>∧</mo><mi>Y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mi>Y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi mathvariant="normal">¬</mi><mi>X</mi><mo>∧</mo><mi mathvariant="normal">¬</mi><mi>Y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} X^{\prime} &amp; =\neg X \wedge Y \\ Y^{\prime} &amp; =\neg X \wedge \neg Y\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">¬</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">¬</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">¬</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span></div><h2 id="wVpvTfWbunjFV5Ao81QpN3" class="wolai-block"><span class="inline-wrap">数字逻辑电路：模拟器</span></h2><div id="99bLTfE6b9TfgYVL4uH9FT" class="wolai-block wolai-text"><div><span class="inline-wrap">X-macro</span></div></div><code-block id="dbXnhDCdwysQjepa2EnH5m" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">REGS_FOREACH</span><span class="token expression"><span class="token punctuation">(</span>_<span class="token punctuation">)</span>  <span class="token function">_</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">_</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span></span><span class="token comment">//有两个寄存器一个叫X一个叫Y</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RUN_LOGIC</span>        <span class="token expression">X1 <span class="token operator">=</span> <span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> Y<span class="token punctuation">;</span> </span><span class="token punctuation">\</span>
                         <span class="token expression">Y1 <span class="token operator">=</span> <span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">DEFINE</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span>        <span class="token keyword">static</span> <span class="token keyword">int</span> X<span class="token punctuation">,</span> X</span><span class="token punctuation">##</span><span class="token expression"><span class="token number">1</span><span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">UPDATE</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span>        X <span class="token operator">=</span> X</span><span class="token punctuation">##</span><span class="token expression"><span class="token number">1</span><span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PRINT</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span>         <span class="token function">printf</span><span class="token punctuation">(</span>#X </span><span class="token string">" = %d; "</span><span class="token expression"><span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">REGS_FOREACH</span><span class="token punctuation">(</span>DEFINE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定义</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// clock</span>
    RUN_LOGIC<span class="token punctuation">;</span><span class="token comment">//运行组合逻辑</span>
    <span class="token function">REGS_FOREACH</span><span class="token punctuation">(</span>PRINT<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打印</span>
    <span class="token function">REGS_FOREACH</span><span class="token punctuation">(</span>UPDATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="9GyB1GdvPgq4DoEhccUBwT" class="wolai-block"><span class="inline-wrap">output</span></h3><div id="8hM3K4pxdZG33qGGtN2xiz" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image.png" style="width: 362.4px"/></figure></div><h3 id="eg3ABESudGnyg4a4ZatEF6" class="wolai-block"><span class="inline-wrap">宏展开</span></h3><code-block id="3VH3EADhhhw7VHEeNrFwF3" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre>gcc <span class="token operator">-</span>E logisim<span class="token punctuation">.</span>c</pre></div></code-block><div id="6VLwMbUt3nxMaNTf6eUD9g" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_1.png" style="width: 473.6px"/></figure></div><code-block id="VPsQPCduezuJPrDJQWve" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">sbrk</span> <span class="token punctuation">(</span><span class="token class-name">intptr_t</span> __delta<span class="token punctuation">)</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__nothrow__ <span class="token punctuation">,</span> __leaf__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
# <span class="token number">1056</span> <span class="token string">"/usr/include/unistd.h"</span> <span class="token number">3</span> <span class="token number">4</span>
<span class="token keyword">extern</span> <span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">syscall</span> <span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">int</span> __sysno<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__nothrow__ <span class="token punctuation">,</span> __leaf__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
# <span class="token number">1079</span> <span class="token string">"/usr/include/unistd.h"</span> <span class="token number">3</span> <span class="token number">4</span>
<span class="token keyword">extern</span> <span class="token keyword">int</span> <span class="token function">lockf</span> <span class="token punctuation">(</span><span class="token keyword">int</span> __fd<span class="token punctuation">,</span> <span class="token keyword">int</span> __cmd<span class="token punctuation">,</span> __off_t __len<span class="token punctuation">)</span> <span class="token punctuation">;</span>
# <span class="token number">1115</span> <span class="token string">"/usr/include/unistd.h"</span> <span class="token number">3</span> <span class="token number">4</span>
<span class="token keyword">extern</span> <span class="token keyword">int</span> <span class="token function">fdatasync</span> <span class="token punctuation">(</span><span class="token keyword">int</span> __fildes<span class="token punctuation">)</span><span class="token punctuation">;</span>
# <span class="token number">1124</span> <span class="token string">"/usr/include/unistd.h"</span> <span class="token number">3</span> <span class="token number">4</span>
<span class="token keyword">extern</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">crypt</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>__key<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>__salt<span class="token punctuation">)</span>
     <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__nothrow__ <span class="token punctuation">,</span> __leaf__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">__nonnull__</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
# <span class="token number">1161</span> <span class="token string">"/usr/include/unistd.h"</span> <span class="token number">3</span> <span class="token number">4</span>
<span class="token keyword">int</span> <span class="token function">getentropy</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>__buffer<span class="token punctuation">,</span> <span class="token class-name">size_t</span> __length<span class="token punctuation">)</span> <span class="token punctuation">;</span>
# <span class="token number">1170</span> <span class="token string">"/usr/include/unistd.h"</span> <span class="token number">3</span> <span class="token number">4</span>
# <span class="token number">1</span> <span class="token string">"/usr/include/x86_64-linux-gnu/bits/unistd_ext.h"</span> <span class="token number">1</span> <span class="token number">3</span> <span class="token number">4</span>
# <span class="token number">1171</span> <span class="token string">"/usr/include/unistd.h"</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span>


# <span class="token number">3</span> <span class="token string">"logisim.c"</span> <span class="token number">2</span>
# <span class="token number">20</span> <span class="token string">"logisim.c"</span>

# <span class="token number">20</span> <span class="token string">"logisim.c"</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">int</span> X<span class="token punctuation">,</span> X1<span class="token punctuation">;</span> <span class="token keyword">static</span> <span class="token keyword">int</span> Y<span class="token punctuation">,</span> Y1<span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">int</span> A<span class="token punctuation">,</span> A1<span class="token punctuation">;</span> <span class="token keyword">static</span> <span class="token keyword">int</span> B<span class="token punctuation">,</span> B1<span class="token punctuation">;</span> <span class="token keyword">static</span> <span class="token keyword">int</span> C<span class="token punctuation">,</span> C1<span class="token punctuation">;</span> <span class="token keyword">static</span> <span class="token keyword">int</span> D<span class="token punctuation">,</span> D1<span class="token punctuation">;</span> <span class="token keyword">static</span> <span class="token keyword">int</span> E<span class="token punctuation">,</span> E1<span class="token punctuation">;</span> <span class="token keyword">static</span> <span class="token keyword">int</span> F<span class="token punctuation">,</span> F1<span class="token punctuation">;</span> <span class="token keyword">static</span> <span class="token keyword">int</span> G<span class="token punctuation">,</span> G1<span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    X1 <span class="token operator">=</span> <span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> Y<span class="token punctuation">;</span> Y1 <span class="token operator">=</span> <span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">;</span> A <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span> B <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> C <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> Y<span class="token punctuation">)</span><span class="token punctuation">;</span> D <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span> E <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span> F <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span> G <span class="token operator">=</span> <span class="token punctuation">(</span>X <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"A"</span> <span class="token string">" = %d; "</span><span class="token punctuation">,</span> A<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"B"</span> <span class="token string">" = %d; "</span><span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"C"</span> <span class="token string">" = %d; "</span><span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"D"</span> <span class="token string">" = %d; "</span><span class="token punctuation">,</span> D<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"E"</span> <span class="token string">" = %d; "</span><span class="token punctuation">,</span> E<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"F"</span> <span class="token string">" = %d; "</span><span class="token punctuation">,</span> F<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"G"</span> <span class="token string">" = %d; "</span><span class="token punctuation">,</span> G<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
    X <span class="token operator">=</span> X1<span class="token punctuation">;</span> Y <span class="token operator">=</span> Y1<span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span>
# <span class="token number">28</span> <span class="token string">"logisim.c"</span> <span class="token number">3</span> <span class="token number">4</span>
          <span class="token constant">stdout</span>
# <span class="token number">28</span> <span class="token string">"logisim.c"</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></div></code-block><h2 id="nFhpP12dRqbrp8VH76MePj" class="wolai-block"><span class="inline-wrap">更完整的实现：数码管显示</span></h2><div id="gWUiT65C7EckY6db77aoUG" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="http://jyywiki.cn/pages/OS/img/NEMU-boot-linux.gif" style="width: 288.8px"/></figure></div><div id="jVP2xijSJSLJ4mZQ3rgGqW" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_2.png" style="width: 398px"/></figure></div><div id="8sb7PtJyN24WTDsC1YYv5T" class="wolai-row"><div id="nzdXtJmVLWCdBiKWxf4p8K" class="wolai-col" style="flex-grow: 0.5"><div id="wRv7Xw8F6Yx1mdgCBg2r28" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="media/image_3.png" style="width: 74.4px"/></figure></div></div><div id="2CjzwjzLTrPF3Xz24i4eg8" class="wolai-col" style="flex-grow: 0.5"><div id="tVa67hXseGsGRkr19W8eRN" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="media/image_4.png" style="width: 80px"/></figure></div><div id="et6cdriV6GBJSCieRXzS8Z" class="wolai-block wolai-text"><div></div></div></div></div><div id="taQBhP7JsK8TuG8wx4HWs1" class="wolai-block wolai-text"><div><span class="inline-wrap">输出数码管的配置信号</span></div></div><ul class="wolai-block"><li id="vQmjovLSUyZ4KwFfiHj1VR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="http://jyywiki.cn/pages/OS/2022/demos/logisim.c"><span>logisim.c</span></a></span></li><li id="mknKo7RL1UcAswVvERJqGG"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">会编程，你就拥有全世界！</span><ul class="wolai-block"><li id="sARmeBwK8FVRxDudW4E841"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="http://jyywiki.cn/pages/OS/2022/demos/seven-seg.py"><span>seven-seg.py</span></a></span></li></ul><aside id="9MaB7mfMoiujoH1KvQ2RXV" class="bg-cultured wolai-block"><div data-symbol="✒️" class="icon"></div><span class="inline-wrap">七段数码管模拟程序</span></aside><ul class="wolai-block"><li id="8v87i3YfKvQbNPzzXMYVng"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">同样的方式可以模拟任何数字系统</span><ul class="wolai-block"><li id="s4ayTpYsSTyspAVLyRZgot"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">当然，也包括计算机系统</span></li></ul></li></ul></li></ul><hr id="guVMRSgRiPFZmDnzMTNrAk" class="wolai-block"/><div id="mQYPC5LCC2GWed9UTF7YKi" class="wolai-block wolai-text"><div><span class="inline-wrap">你还体验了 UNIX 哲学</span></div></div><ul class="wolai-block"><li id="3ii2VztuSPPfZY76rnYW2T"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Make each program do one thing well</span></li><li id="v2CjcYRuAgTp4KNj1HhHvx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Expect the output of every program to become the input to another</span></li></ul><h1 id="gCS2Q5wsvK47icc7xBABcR" class="wolai-block"><span class="inline-wrap">什么是程序 (源代码视角)</span></h1><h2 id="ch1TPwt3VFzZ3qAeMGSLm" class="wolai-block"><span class="inline-wrap">什么是程序？</span></h2><div id="tsGzC2MfdEfnMeiBfoyvkp" class="wolai-block wolai-text"><div><span class="inline-wrap">Hmm....</span></div></div><hr id="48gC46hx3CtfdPCRqf3YEY" class="wolai-block"/><div id="7QvGn1B5TU6JgksFMTwSf7" class="wolai-row"><div id="97YYJ5e9WAhEkb4poFAXq" class="wolai-col" style="flex-grow: 0.5"><div id="fnTicKjFrQ4QwRdv6jKt4W" class="wolai-block wolai-text"><div><span class="inline-wrap">你需要《</span><span class="inline-wrap"><a href="https://cs.nju.edu.cn/hongjin/teaching/semantics/index.htm"><span>程序设计语言的形式语义</span></a></span><span class="inline-wrap">》</span></div></div><ul class="wolai-block"><li id="5mqcJLHK3JteseNner8vC7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">by 梁红瑾 </span></li><li id="54muarXDNwvWsXEffWXvrY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">λ-calculus, operational semantics, Hoare logic, separation logic</span></li><li id="vCkvoL3hUNUWb9MJb41Gdk"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">入围 “你在南京大学上过最牛的课是什么？” 知乎高票答案</span><ul class="wolai-block"><li id="hFx3maaa7s2sonx6iCdQFR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">当然，我也厚颜无耻地入围了</span></li></ul></li></ul></div><div id="fMbkA32dxK7uDUDdg23ea3" class="wolai-col" style="flex-grow: 0.5"><div id="7KMVuVB1dzvnL8SSu4RRDj" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="https://cs.nju.edu.cn/hongjin/me.png" style="width: 183.2px"/></figure></div></div></div><h2 id="7qDrNC3XEmbsWuGVs6RUxj" class="wolai-block"><span class="inline-wrap"><del>不，你不需要</del></span></h2><div id="kr8fgbuEVzi8QbZfjsMxVw" class="wolai-block wolai-text"><div><span class="inline-wrap">程序就是状态机 (你在 gdb 里看到的)</span></div></div><ul class="wolai-block"><li id="eSopNRVU1YFQomFPUDnbvy"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">试试程序吧 </span><span class="inline-wrap"><a href="http://jyywiki.cn/pages/OS/2022/demos/hanoi-r.c"><span>hanoi-r.c</span></a></span></li></ul><hr id="rwz9r1eBi1S9tXxDVmz186" class="wolai-block"/><div id="nG5YZrPr5Gzhh5UESTSNbv" class="wolai-block wolai-text"><div><span class="inline-wrap">C 程序的状态机模型 (语义，semantics)</span></div></div><ul class="wolai-block"><li id="jFPBVhqWkFJYnbP918ZjFT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">状态 = 堆 + 栈</span></li><li id="8GVG2Tbu55VRwp1mJE7mfR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">初始状态 = </span><span class="inline-wrap"><code>main</code></span><span class="inline-wrap"> 的第一条语句</span></li><li id="s7Z6C8Gyt23xfGCL85Zyh3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">迁移 = 执行一条简单语句</span><ul class="wolai-block"><li id="aXf5GCQqJrnpH7Fuq9Q4CZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">任何 C 程序都可以改写成 “非复合语句” 的 C 代码</span></li><li id="djew7fUQfyc3j7S7bLtPJ4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://cil-project.github.io/cil/"><span>真的有这种工具</span></a></span><span class="inline-wrap"> (C Intermediate Language) 和</span><span class="inline-wrap"><a href="https://gitlab.com/zsaleeba/picoc"><span>解释器</span></a></span></li></ul></li></ul><hr id="bmGQJmXzPvj2DnjDZnNPqt" class="wolai-block"/><div id="ii87RFKViQiZHMZLFHuTAv" class="wolai-block wolai-text"><div><span class="inline-wrap">(这还只是 “粗浅” 的理解)</span></div></div><ul class="wolai-block"><li id="jMAkB5xrZDLFcHA6oTMpcN"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Talk is cheap. Show me the code. (Linus Torvalds): 任何真正的理解都应该落到可以执行的代码</span></li></ul><h2 id="e6J9UHbEHoiNRVH4bgexqN" class="wolai-block"><span class="inline-wrap">C 程序的语义</span></h2><div id="aA2SmFAUbDrGNtS6caf3gP" class="wolai-block wolai-text"><div><span class="inline-wrap">C 程序的状态机模型 (语义，semantics)</span></div></div><ul class="wolai-block"><li id="msnRUsw1xj4gR4CyVMrRX8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">状态 = stack frame 的列表 (每个 frame 有 PC) + 全局变量</span></li><li id="trhkbQWq4qyUqm6mLt2dN3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">初始状态 = main(argc, argv), 全局变量初始化</span></li><li id="v9ZFRjYE7pzoS8rbPWgiwU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">迁移 = 执行 top stack frame PC 的语句; PC++</span><ul class="wolai-block"><li id="2whALMRBZKJ3ZhLRE2Zcsy"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">函数调用 = push frame (frame.PC = 入口)</span></li><li id="k4T4vJ8aubbAFtekNQFyur"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">函数返回 = pop frame</span></li></ul></li></ul><hr id="eqk5gm92ZmaZ1zYt1oQ7gt" class="wolai-block"/><div id="ggBjboUyBNQxhKPbN3wwj9" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>应用：将任何递归程序就地转为非递归</b></span></div></div><ul class="wolai-block"><li id="3XXYqz7Fc2d1SmdwgS2E6r"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">汉诺塔难不倒你 </span><span class="inline-wrap"><a href="http://jyywiki.cn/pages/OS/2022/demos/hanoi-nr.c"><span>hanoi-nr.c</span></a></span></li><li id="9gSwvyMBacucKcZ5SmgB4c"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">A → B, B → A 的也难不倒你</span><ul class="wolai-block"><li id="oCjiN5HajEsdwqS8xpLqgx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">还是一样的 </span><span class="inline-wrap"><code>call()</code></span><span class="inline-wrap">，但放入不同的 </span><span class="inline-wrap"><code>Frame</code></span></li></ul><code-block id="rQXamSBfVxPtTUL2i25Axm" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> pc<span class="token punctuation">,</span> n<span class="token punctuation">;</span>
  <span class="token keyword">char</span> from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> via<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Frame<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">call</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">++</span>top<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Frame<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span>pc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> __VA_ARGS__ <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">ret</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">goto</span><span class="token expression"><span class="token punctuation">(</span>loc<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> f<span class="token operator">-></span>pc <span class="token operator">=</span> <span class="token punctuation">(</span>loc<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">void</span> <span class="token function">hanoi</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">char</span> from<span class="token punctuation">,</span> <span class="token keyword">char</span> to<span class="token punctuation">,</span> <span class="token keyword">char</span> via<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Frame stk<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>top <span class="token operator">=</span> stk <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token function">call</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> via<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>Frame <span class="token operator">*</span>f<span class="token punctuation">;</span> <span class="token punctuation">(</span>f <span class="token operator">=</span> top<span class="token punctuation">)</span> <span class="token operator">>=</span> stk<span class="token punctuation">;</span> f<span class="token operator">-></span>pc<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>f<span class="token operator">-></span>pc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token operator">-></span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c -> %c\n"</span><span class="token punctuation">,</span> f<span class="token operator">-></span>from<span class="token punctuation">,</span> f<span class="token operator">-></span>to<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">goto</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token function">call</span><span class="token punctuation">(</span>f<span class="token operator">-></span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token operator">-></span>from<span class="token punctuation">,</span> f<span class="token operator">-></span>via<span class="token punctuation">,</span> f<span class="token operator">-></span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token function">call</span><span class="token punctuation">(</span>       <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token operator">-></span>from<span class="token punctuation">,</span> f<span class="token operator">-></span>to<span class="token punctuation">,</span>  f<span class="token operator">-></span>via<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token function">call</span><span class="token punctuation">(</span>f<span class="token operator">-></span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token operator">-></span>via<span class="token punctuation">,</span>  f<span class="token operator">-></span>to<span class="token punctuation">,</span>  f<span class="token operator">-></span>from<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token function">ret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></div></code-block></li></ul><h1 id="ccFexLd4RgR5wxUSDDviY9" class="wolai-block"><span class="inline-wrap">什么是程序 (二进制代码视角)</span></h1><h2 id="mbxC5cmUM6XuvxHEJV5g5a" class="wolai-block"><span class="inline-wrap">什么是 (二进制) 程序？</span></h2><div id="bZ7oxcK95K9d1JLr6RnuUo" class="wolai-block wolai-text"><div><span class="inline-wrap">还是状态机</span></div></div><ul class="wolai-block"><li id="u4DbMhPed2pnpSRhmpTkQU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">状态 = 内存 M + 寄存器 R</span></li><li id="t3uAw87y4DE7nLkagLdnLa"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">初始状态 = (稍后回答)</span></li><li id="akzgb9VZjhc5nBPHX5kGS7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">迁移 = 执行一条指令</span><ul class="wolai-block"><li id="banvrNvFVvGYqEqxayd29C"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">我们花了一整个《计算机系统基础》解释这件事</span></li><li id="691akLwm6eBz2dtRZZNZzs"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">gdb 同样可以观察状态和执行</span></li></ul></li></ul><hr id="2JYipPtPk9ktnfKtoYh2pN" class="wolai-block"/><div id="8WxjuLGx3PwmzW56A3YVNs" class="wolai-block wolai-text"><div><span class="inline-wrap">操作系统上的程序</span></div></div><ul class="wolai-block"><li id="3Gh1mvdXTCTTeQZAc5Pk1Y"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">所有的指令都只能计算</span><ul class="wolai-block"><li id="rNiXKTATR4cSHjQfr54UhH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">deterministic: mov, add, sub, call, ...
确定性: mov，add，sub，call，...</span></li><li id="cY59qBnwc1uJTRYgFHK34Q"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">non-deterministic: rdrand, ...
非确定性: rdrand，...</span></li><li id="n7f4nTCdY9Y8me8mSajLTF"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">但这些指令甚至都无法使程序停下来 (NEMU: 加条 </span><span class="inline-wrap"><code>trap</code></span><span class="inline-wrap"> 指令)</span></li></ul></li></ul><h2 id="jX1kayf4nzSSS6fLKSW2Ff" class="wolai-block"><span class="inline-wrap">一条特殊的指令</span></h2><div id="8sX43wC9yhmM7bNrXRiY1z" class="wolai-block wolai-text"><div><span class="inline-wrap">调用操作系统 syscall</span></div></div><ul class="wolai-block"><li id="qYW6QKcJ1cTRDBistUkMt7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">把 (M,R) 完全交给操作系统，任其修改</span><ul class="wolai-block"><li id="ctDKph8XYPAnH2BC9X2bL9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">一个有趣的问题：如果程序不打算完全信任操作系统？</span></li></ul></li><li id="4N4fJ5gSUKCffB3cNMmHLm"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">实现与操作系统中的其他对象交互</span><ul class="wolai-block"><li id="wQ9EnN4wxAJfWwDXJbekQ8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">读写文件/操作系统状态 (例如把文件内容写入<span class="jill"></span>M)</span></li><li id="bmz7vHNVihhE4suZrCiCQw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">改变进程 (运行中状态机) 的状态，例如创建进程/销毁自己</span></li></ul></li></ul><hr id="i2CshNk3GgiDCLsnzFZJD7" class="wolai-block"/><div id="sfhrqHzFrGErnohoH7dyaf" class="wolai-block wolai-text"><div><span class="inline-wrap">程序 = 计算 + syscall</span></div></div><ul class="wolai-block"><li id="wynq3sdhY6jEXUx9KtDc1u"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">问题：怎么构造一个最小的 Hello, World？</span></li></ul><h2 id="wT1CyfY26Kt72ELoSpHb58" class="wolai-block"><span class="inline-wrap">构造最小的 Hello, World</span></h2><code-block id="cGTxo2BwkKcY2KTRZzZCQw" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">int main() {

  printf("Hello, World\n");

}</span><span class="token template-punctuation string">`</span></span> </pre></div></code-block><hr id="iujbD2S6vvU64YVGwuXWxq" class="wolai-block"/><div id="uBHbxFMgsz8dtj1voSBHs6" class="wolai-block wolai-text"><div><span class="inline-wrap">gcc 编译出来的文件不满足 “最小”</span></div></div><ul class="wolai-block"><li id="8JbtfeJncixS2xyP8Ph5iU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>--verbose</code></span><span class="inline-wrap"> 可以查看所有编译选项 (真不少)</span><ul class="wolai-block"><li id="pUoQeL4XbZSmHW77yqYDJJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">printf 变成了 puts@plt</span></li></ul></li><li id="nGp4XYwjxhuW3LZyZgRFZo"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>-static</code></span><span class="inline-wrap"> 会复制 libc</span></li></ul><h1 id="qCNngTYrf6HUiz77NNgyda" class="wolai-block"><span class="inline-wrap">如何在程序的两个视角之间切换？</span></h1></article><footer></footer></body></html>