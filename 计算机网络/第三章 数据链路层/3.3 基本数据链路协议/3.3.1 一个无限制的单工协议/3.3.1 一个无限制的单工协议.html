<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>3.3.1 一个无限制的单工协议 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="3.3.1 一个无限制的单工协议" class="main-title"></div></div></header><article><h3 id="8rHF8uwt58LeV4LtAosbej" class="wolai-block"><span class="inline-wrap">条件</span></h3><ul class="wolai-block"><li id="aGbGVF3hJmq9pziyCz4JV8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">数据单向传输</span></li><li id="bGJsXXLN2N5tnNPFk9gqYd"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">数据处理时间忽略不计，可用的缓存空间无限大（无流控）</span></li><li id="dkAHRXCJrKNdPpFb8quzNz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">通信永远不会损坏或丢失帧（无噪声、差错控制）</span></li></ul><div id="u8edoaFS6PD1HpqpWBz8yR" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image.png" style="width: 100%"/></figure></div><div id="4UZvBxCNdgXVbfjNYgMLSJ" class="bg-blond wolai-block wolai-text"><div><span class="inline-wrap"><b>在这样理想化的条件下,数据的传输就非常简单(不需要有流量控制,也不需要有差错控制)。</b></span></div></div><h3 id="7eJo1Kfg6p5ezS2Q1NmCkV" class="wolai-block"><span class="inline-wrap">简化模型</span></h3><div id="6TTrp18eSALrvBMMHLYamM" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_1.png" style="width: 100%"/></figure></div><h3 id="bAG2Fca2LHJ4Zc9T3ngkNt" class="wolai-block"><span class="inline-wrap">代码</span></h3><div id="wsepdF46vNufcW41M5Cbym" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_2.png" style="width: 100%"/></figure></div><code-block id="4ivko3JZhyZScq2t3J4QqH" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">/* Protocol 1 (utopia) provides for data transmission in one direction only, from
   sender to receiver.  The communication channel is assumed to be error free,
   and the receiver is assumed to be able to process all the input infinitely fast.
   Consequently, the sender just sits in a loop pumping data out onto the line as
   fast as it can. */</span>

<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token punctuation">{</span>frame_arrival<span class="token punctuation">}</span> event_type<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"protocol.h"</span></span>

<span class="token keyword">void</span> <span class="token function">sender1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token comment">//发送过程</span>
<span class="token punctuation">{</span>
  frame s<span class="token punctuation">;</span>  <span class="token comment">/* buffer for an outbound frame */</span>
  packet buffer<span class="token punctuation">;</span>  <span class="token comment">/* buffer for an outbound packet */</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>true<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">from_network_layer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* go get something to send */</span>
        <span class="token comment">// 从（总是就绪的）的网络层获取一个数据包 </span>
        s<span class="token punctuation">.</span>info <span class="token operator">=</span> buffer<span class="token punctuation">;</span>  <span class="token comment">/* copy it into s for transmission */</span>
        <span class="token comment">// 利用变量s构造一个出境帧</span>
        <span class="token comment">// 这里由于没有流量控制和差错控制 这里就很简单</span>
        <span class="token function">to_physical_layer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* send it on its way */</span>
        <span class="token comment">// 通过物理层发送该帧</span>
  <span class="token punctuation">}</span>  <span class="token comment">/* tomorrow, and tomorrow, and tomorrow,
      Creeps in this petty pace from day to day
     To the last syllable of recorded time;
          - Macbeth, V, v */</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">receiver1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token comment">//接收过程</span>
<span class="token punctuation">{</span>
  frame r<span class="token punctuation">;</span>
  event_type event<span class="token punctuation">;</span>  <span class="token comment">/* filled in by wait, but not used here */</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>true<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">wait_for_event</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* only possibility is frame_arrival */</span>
        <span class="token comment">// 等待一个事件发生 这里唯一可能的事件就是到达一个没有被损坏的帧</span>
        <span class="token function">from_physical_layer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* go get the inbound frame */</span>
        <span class="token comment">// 将新到达的帧从硬件缓存中放到变量r中</span>
        <span class="token function">to_network_layer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>r<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* pass the data to the network layer */</span>
        <span class="token comment">// 传递该帧到网络层</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="56dSN8sWNxDYCamd7HWr7Q" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_3.png" style="width: 100%"/></figure></div></article><footer></footer></body></html>