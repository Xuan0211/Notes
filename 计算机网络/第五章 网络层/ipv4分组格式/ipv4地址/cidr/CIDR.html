<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>CIDR - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="CIDR" class="main-title"></div></div></header><article><h2 id="bvEw8aMAwPzqfRnvDAss1M" class="wolai-block"><span class="inline-wrap">记法</span></h2><h3 id="vBoeQvZ6TQAYeiK7U18HsD" class="wolai-block"><span class="inline-wrap">一般记法</span></h3><div id="qsEwq9MdNnieMEHS541Rdd" class="wolai-block wolai-text"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mi>P</mi><mo>:</mo><mo>:</mo><mo>=</mo><mo stretchy="false">{</mo><mo>&lt;</mo><mtext>网络前缀</mtext><mo>&gt;</mo><mo separator="true">,</mo><mo>&lt;</mo><mtext>主机号</mtext><mo>&gt;</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">IP:: =\{&lt; 网络前缀 &gt;,&lt; 主机号 &gt;\} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">::=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord cjk_fallback">网络前缀</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord cjk_fallback">主机号</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">}</span></span></span></span></span></div><h3 id="8xdXNFHf5zoyMgkuafQgRz" class="wolai-block"><span class="inline-wrap">斜线记法</span></h3><div id="ccHtHN9LCSwMVWRDhJhoSU" class="wolai-block wolai-text"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mi>P</mi><mtext>地址</mtext><mi mathvariant="normal">/</mi><mtext>网络前缀所占比特数</mtext></mrow><annotation encoding="application/x-tex">IP 地址/网络前缀所占比特数</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord cjk_fallback">地址</span><span class="mord">/</span><span class="mord cjk_fallback">网络前缀所占比特数</span></span></span></span></span></div><div id="3NApXjKV82mPXiRBkGGvg5" class="wolai-block wolai-text"><div><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>例如</mtext><mo separator="true">,</mo><mtext>对于</mtext><mn>128.14.32.5</mn><mi mathvariant="normal">/</mi><mn>20</mn></mrow><annotation encoding="application/x-tex">例如, 对于 128.14 .32 .5 / 20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">例如</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord cjk_fallback">对于</span><span class="mord">128.14.32.5/20</span></span></span></span></span></div></div><div id="4kTNYCtr2YyLBB8RgNXALf" class="wolai-block wolai-text"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>逐位与</mtext><mrow><mo fence="true">{</mo><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">P</mi></mrow><mo>=</mo><mtext>    </mtext><mn>10000000.00001110.00100000.00000101</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>掩码</mtext><mo>=</mo><mn>11111111.11111111.11110000.00000000</mn></mrow></mstyle></mtd></mtr></mtable></mrow><mspace linebreak="newline"></mspace><mtext>                             网络前缀</mtext><mo>=</mo><mn>10000000.00001110.00100000.00000000</mn><mo stretchy="false">(</mo><mn>128.14.32.0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">逐位与 \left\{\begin{array}{l}\mathrm{IP}=\ \ \ \ 10000000.00001110 .00100000 .00000101 \\ 掩码 =11111111.11111111 .11110000 .00000000\end{array}\right.\\\ \ \ \ \ \ \ \ \ \ \ \  \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 网络前缀 = 10000000.00001110 .00100000 .00000000 (128.14.32.0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord cjk_fallback">逐位与</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">{</span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">IP</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">10000000.00001110.00100000.00000101</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">掩码</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">11111111.11111111.11110000.00000000</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mord cjk_fallback">网络前缀</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">10000000.00001110.00100000.00000000</span><span class="mopen">(</span><span class="mord">128.14.32.0</span><span class="mclose">)</span></span></span></span></span></div><h2 id="bDdhExZe5rz3m2xVLj79Eo" class="wolai-block"><span class="inline-wrap">“CIDR”不使用子网</span></h2><div id="7GBzRqPYTJwT4u5ZMGWR7S" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image.png" style="width: 100%"/></figure></div><h2 id="7uGUFCTQZS7xyScMLxuSba" class="wolai-block"><span class="inline-wrap">地址块与路由聚合</span></h2><div id="uyj9bk8NzWv9FaPcazVRXi" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_1.png" style="width: 100%"/></figure></div><aside id="bdkVfMvQuhrMc1NSUDRyMW" class="green wolai-block"><div data-symbol="🌲" class="icon"></div><span class="inline-wrap">路由聚合目的：缩小路由表的表项</span></aside><h4 id="45QB2D2GcFEBDSxrfARskU" class="wolai-block"><span class="inline-wrap">CIDR<span class="jill"></span>路由聚合示例</span></h4><div id="8Xw7UBdykHpuKozesWyEmH" class="wolai-block wolai-text"><div><span class="inline-wrap">•某<span class="jill"></span>ISP<span class="jill"></span>已经有一个地址块<span class="jill"></span>200.23.16.0/20</span></div></div><div id="a7tax5sPgbReqhHrmjjN2F" class="wolai-block wolai-text"><div><span class="inline-wrap">•它可以依次序将该地址块分成八个大小相等的连续的更小的地址块</span></div></div><div id="pQP9GfNd2XD9Ye2cWB18UJ" class="wolai-block wolai-text"><div><span class="inline-wrap">•分别分配给它服务的<span class="jill"></span>8<span class="jill"></span>个组织，网络结构见下图</span></div></div><div id="qZqbjZwCnhmzpxe6cmCiNu" class="wolai-block wolai-text"><div><span class="inline-wrap">•Internet<span class="jill"></span>其它组织或用户不需要知道在地址块<span class="jill"></span>200.23.16.0/20<span class="jill"></span>内实际上还存在这<span class="jill"></span>8<span class="jill"></span>个组织的子网，只需要找到<span class="jill"></span>200.23.16.0/20，就能找到这<span class="jill"></span>ISP，再由<span class="jill"></span>ISP<span class="jill"></span>可能找到<span class="jill"></span>8<span class="jill"></span>个子网中任何一个，减少了路由器维护的表项数</span></div></div><div id="gnMomeGokW8WPk6T5GjyKs" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_2.png" style="width: 747.2px"/></figure></div><h4 id="kjLjauGBD61JiKz3QjNKmZ" class="wolai-block"><span class="inline-wrap">地址块中的地址数</span></h4><div id="gYU4MwqGPLyipKPZDgXqmz" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_3.png" style="width: 100%"/></figure></div><div id="7cLWPGEdq5afmsSh2ZaRPp" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_4.png" style="width: 100%"/></figure></div><div id="b8DLmhEpbQjbBeYTD9qZWV" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_5.png" style="width: 628.8px"/></figure></div><div id="31NwrVmCX9cc1L2JoKBoXR" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_6.png" style="width: 590.4px"/></figure></div><h3 id="wor1B6isrcsr1b2nQjki7x" class="wolai-block"><span class="inline-wrap">分配例子</span></h3><div id="2dbYHpV8DuvZ7jodPejCMX" class="wolai-block wolai-text"><div><span class="inline-wrap">•有一块地址从<span class="jill"></span>194.24.0.0<span class="jill"></span>开始，可用的地址数是<span class="jill"></span>8192<span class="jill"></span>个，即<span class="jill"></span>194.24.0.0/19，分配情况如下图</span></div></div><div id="gaNi7Gg7twA94bfRh22fka" class="wolai-block wolai-text"><div><span class="inline-wrap">•剑桥需要<span class="jill"></span>2048，主机需要<span class="jill"></span>11<span class="jill"></span>位，网络位是<span class="jill"></span>32-11=21<span class="jill"></span>位。 194.24.0.0<span class="jill"></span>开始到<span class="jill"></span>192.24.7.255 1100001000011000 00000 111 11111111 </span></div></div><div id="oAurzSZgEGo2VdCtWpNHMk" class="wolai-block wolai-text"><div><span class="inline-wrap">•爱丁堡需要<span class="jill"></span>1024，所以只需要<span class="jill"></span>10<span class="jill"></span>位主机位，网络为<span class="jill"></span>22<span class="jill"></span>位</span></div></div><div id="kRfHxKCHnevKWfTdBhGXvk" class="wolai-block wolai-text"><div><span class="inline-wrap">•194.24.11.255 1100001000011000 00000 1011 11111111</span></div></div><div id="zgzgHC4f1F196HBXF1jgi" class="wolai-block wolai-text"><div><span class="inline-wrap">•其他分配从<span class="jill"></span>194.24.12.0<span class="jill"></span>开始<span class="jill"></span>11000010 00011000 0000110000000000</span></div></div><div id="5ktTRcU95yth4GG5HQHtXR" class="wolai-block wolai-text"><div><span class="inline-wrap">•到<span class="jill"></span>194.24.15.155 11000010 00011000 000011111111111</span></div></div><div id="dSbQvuBwQXxMyeoLf1pcn2" class="wolai-block wolai-text"><div><span class="inline-wrap">•牛津大学需要<span class="jill"></span>4096<span class="jill"></span>个主机，需要<span class="jill"></span>12<span class="jill"></span>位，网络位<span class="jill"></span>20<span class="jill"></span>位，从<span class="jill"></span>194.24.16.0<span class="jill"></span>开始到<span class="jill"></span>193.23.31.255 11000010 0001100000011111 11111111</span></div></div><div id="9u6zzgSmDhMiWvAJ5KCVd" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_7.png" style="width: 100%"/></figure></div><div id="kJQTxgwKQzLCtY9QEhKE1X" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_8.png" style="width: 100%"/></figure></div><h2 id="g6FBU8tzJcXpmyBJvCbAet" class="wolai-block"><span class="inline-wrap">路由</span></h2><div id="nehaofGtkUSznVibMifM7j" class="wolai-block wolai-text"><div><span class="inline-wrap">•从纽约的远程路由器来看，3<span class="jill"></span>个前缀的所有<span class="jill"></span>IP<span class="jill"></span>地址合成一个聚合表项，即前缀<span class="jill"></span>194.24.0.0/19<span class="jill"></span>地址从<span class="jill"></span>194.24.0.0<span class="jill"></span>开始，可用的地址是<span class="jill"></span>8192<span class="jill"></span>个（即<span class="jill"></span>2<span class="jill"></span>的<span class="jill"></span>13<span class="jill"></span>次方即位<span class="jill"></span>8192）</span></div></div><div id="6nEfNrdpKks3CFgiKxXZu3" class="wolai-block wolai-text"><div><span class="inline-wrap">•通过聚合，3<span class="jill"></span>个不同前缀的网络被聚合为一个超网（即三所大学的<span class="jill"></span>3<span class="jill"></span>个前缀合并成一个聚合表项）194.24.0.0/19，大大降低了表项数</span></div></div><div id="haJaG9htZuUxi5QxsEpgmi" class="wolai-block wolai-text"><div><span class="inline-wrap">•假如一个<span class="jill"></span>IP<span class="jill"></span>地址是<span class="jill"></span>194.24.17.4，将该地址与<span class="jill"></span>Mask<span class="jill"></span>相与，只与<span class="jill"></span>Oxford<span class="jill"></span>匹配，选取<span class="jill"></span>Oxford，即<span class="jill"></span>Oxford<span class="jill"></span>牛津大学对应的路由器端口</span></div></div><div id="h7Y6csjvWbybcr5gK7S2gL" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_9.png" style="width: 680px"/></figure></div><h3 id="mSWCayUTDcaFwVsae7URQA" class="wolai-block"><span class="inline-wrap">最长前缀匹配(longest-prefixmatching)</span></h3><div id="j5EN9Po5bjtFLr1kBekHBs" class="wolai-block wolai-text"><div><span class="inline-wrap">•使用 CIDR 时，路由表中的每个项目由“网络前缀”和“下一跳地址”组成</span></div></div><div id="w96DZRUUZvhPfqkyZQ3vqL" class="wolai-block wolai-text"><div><span class="green inline-wrap"><b>•在查找路由表时可能会得到不止一个匹配结果</b></span></div></div><div id="pbXr9LTqf4DTfHJmmh6Tp1" class="wolai-block wolai-text"><div><span class="inline-wrap">•应当从匹配结果中选择具有最长网络前缀的路由，即最长前缀匹配</span></div></div><div id="87ovB69FhNfotULq1rBCty" class="wolai-block wolai-text"><div><span class="inline-wrap">•网络前缀越长，其地址块就越小，因而路由就越具体</span></div></div><div id="vEq2HL2GUVQUqEhFYWQib8" class="wolai-block wolai-text"><div><span class="inline-wrap">•最长前缀匹配又称为最长匹配或最佳匹配</span></div></div><h4 id="Qfa8E4iSVPNkRW7L79q4V" class="wolai-block"><span class="inline-wrap">举个栗子🌰一：</span></h4><div id="asMKScVymgTdP6tgikCmvY" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_10.png" style="width: 100%"/></figure></div><div id="npDCgbGoysKS9pGwyCwnyp" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_11.png" style="width: 567.2px"/></figure></div><h4 id="kkzqHSTPhqZTobthgyodMs" class="wolai-block"><span class="inline-wrap">举个栗子🌰二：</span></h4><div id="rwBSfjR8xsrHN6GUw7HNKu" class="wolai-block wolai-text"><div><span class="inline-wrap">•一个目标地址为<span class="jill"></span>192.23.12.2<span class="jill"></span>的<span class="jill"></span>IP<span class="jill"></span>分组经过<span class="jill"></span>New York<span class="jill"></span>路由器</span></div></div><div id="ttK3ENZ89b5FHWd8z4vsgP" class="wolai-block wolai-text"><div><span class="inline-wrap">•与<span class="jill"></span>19<span class="jill"></span>位的子网掩码<span class="jill"></span>AND<span class="jill"></span>操作后，匹配的结果是<span class="jill"></span>192.24.0.0</span></div></div><div id="4cQ1vesLnyB9Npp5xKm9J7" class="wolai-block wolai-text"><div><span class="inline-wrap">•与<span class="jill"></span>22<span class="jill"></span>位的子网掩码<span class="jill"></span>AND<span class="jill"></span>操作后，匹配的结果是<span class="jill"></span>192.24.12.0</span></div></div><div id="whJCkjf94JPzJAVpG2b4qf" class="wolai-block wolai-text"><div><span class="inline-wrap">•按照最长匹配前缀路由规则，22<span class="jill"></span>比<span class="jill"></span>19<span class="jill"></span>长，所以该<span class="jill"></span>IP<span class="jill"></span>分组被发往圣弗朗西斯科，而不是伦敦</span></div></div><div id="4Sm4ztDXNfniG671Z9Smpa" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_12.png" style="width: 100%"/></figure></div><h2 id="oqVv1SfqvdVwZP3A13Wyfa" class="wolai-block"><span class="inline-wrap">路由转发过程</span></h2><div id="tgDnWGmgCxaEzHnxuRhTHQ" class="wolai-block wolai-text"><div><span class="inline-wrap">•在不划分子网的两级<span class="jill"></span>IP<span class="jill"></span>地址下的<span class="jill"></span>IP<span class="jill"></span>分组转发过程</span></div></div><div id="ecFp4pc1jxW3uTRMAVZLng" class="wolai-block wolai-text"><div><span class="inline-wrap">•分类<span class="jill"></span>IPv4<span class="jill"></span>地址中每一类地址都由两个固定长度的网络号<span class="jill"></span>net-id<span class="jill"></span>和主机号<span class="jill"></span>host-id<span class="jill"></span>字段组成，且网络掩码是默认的</span></div></div><div id="3sYiddcyk943VBHc22zxxt" class="wolai-block wolai-text"><div><span class="inline-wrap">•IPv4<span class="jill"></span>地址是标志一个主机（或路由器）和一条链路的接口</span></div></div><div id="91jRcnPqtoSmcAqP4cVVzB" class="wolai-block wolai-text"><div><span class="inline-wrap">•每个路由器至少应连接到两个网络，以便能将<span class="jill"></span>IPv4<span class="jill"></span>分组从一个网络转发到另一个网络，因此一个路由器至少应当有两个不同的<span class="jill"></span>IPv4<span class="jill"></span>地址</span></div></div><h4 id="vBfaigRsWiWKodq1UpT5w" class="wolai-block"><span class="inline-wrap">使用网络地址作为路由表项中目的地的路由</span></h4><div id="rmmn2vfczw19iaWnAzQ6cv" class="wolai-block wolai-text"><div><span class="inline-wrap">•假设有四个<span class="jill"></span>A<span class="jill"></span>类网络通过三个路由器连接在一起</span></div></div><div id="nhEbxxmnwG8VhG6D5vBa4N" class="wolai-block wolai-text"><div><span class="inline-wrap">•每一个网络上都可能有成千上万个主机</span></div></div><div id="eTRW9Ydf6ktsKHTe9HgxQz" class="wolai-block wolai-text"><div><span class="inline-wrap">•若按目的主机号来制作路由表，则每一个路由表都会过于庞大</span></div></div><div id="5jZi55WJnNezxc7c51uFM7" class="wolai-block wolai-text"><div><span class="inline-wrap">•若按主机所在的网络地址来制作路由表，则每一个路由器中的路由表就会大大简化</span></div></div><div id="2f2fo747xgijz9QzGkbrHZ" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_13.png" style="width: 100%"/></figure></div><h4 id="aqcNJ6V1gA9E45F4pnehxM" class="wolai-block"><span class="inline-wrap">基于目的网络地址的路由表项查找</span></h4><div id="cH9PFF4az26NBZ7coKzoFC" class="wolai-block wolai-text"><div><span class="inline-wrap">•根据目的网络地址就能确定下一跳路由器，这样做的结果是</span></div></div><div id="2d8uiz4J1VnF8qKaryFkqN" class="wolai-block wolai-text"><div><span class="inline-wrap">•IP<span class="jill"></span>分组最终一定可以找到目的主机所在目的网络上的路由器（可能要通过多次的间接交付）</span></div></div><div id="9DAn7wagBXdVtSpYGnQgNq" class="wolai-block wolai-text"><div><span class="inline-wrap">•只有到达最后一个路由器时，才试图向目的主机进行直接交付</span></div></div><div id="sj1nybui5vaknCoBWK6pFq" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_14.png" style="width: 100%"/></figure></div><h3 id="u34KrB7fGn3aru9UqCNr8V" class="wolai-block"><span class="inline-wrap">在不划分子网的两级<span class="jill"></span>IP<span class="jill"></span>地址下的<span class="jill"></span>IP<span class="jill"></span>分组转发过程</span></h3><h4 id="kumdrEGfhUJsda8M2YebGE" class="wolai-block"><span class="inline-wrap">基于特定主机路由的路由表项查找</span></h4><div id="8aBqLUpUPgZam8dwkCYHAn" class="wolai-block wolai-text"><div><span class="inline-wrap">•虽然互联网所有的分组转发都是基于目的主机所在的网络</span></div></div><div id="oQdYrm8PmBShApfoptuW9T" class="wolai-block wolai-text"><div><span class="inline-wrap">•但在大多数情况下都允许有这样的特例</span></div></div><div id="qa2RqYZ2K5rWtXvBCXcEuK" class="wolai-block wolai-text"><div><span class="inline-wrap">•即为特定的目的主机指明一个路由</span></div></div><div id="tyREbKMtkcPoYcq2HZPAfX" class="wolai-block wolai-text"><div><span class="inline-wrap">•采用特定主机路由可使网络管理人员能更方便地控制网络和测试网络</span></div></div><div id="7MFg3YbMiXpiF844TkFXYi" class="wolai-block wolai-text"><div><span class="inline-wrap">•同时也可在需要考虑某种安全问题时采用这种特定主机路由</span></div></div><h4 id="4h89gUGwD354vtWxdRo5QD" class="wolai-block"><span class="inline-wrap">基于默认路由的路由表项查找</span></h4><div id="8KFhCrc3LCATJSyAHp9VVN" class="wolai-block wolai-text"><div><span class="inline-wrap">•路由器可采用默认路由以减少路由表所占用的空间和搜索路由表所用的时间</span></div></div><div id="8h65DSJCKhMfL7k1ky7gX6" class="wolai-block wolai-text"><div><span class="inline-wrap">•这种转发方式在一个网络只有很少的对外连接时是很有用的</span></div></div><div id="aRPcb1VPCFtWD96JtscrHn" class="wolai-block wolai-text"><div><span class="inline-wrap">•默认路由在主机发送<span class="jill"></span>IP<span class="jill"></span>分组时往往更能显示出它的好处</span></div></div><div id="dMhy9Rngrn8ahJZ262t6P6" class="wolai-block wolai-text"><div><span class="inline-wrap">•如果一个主机连接在一个小网络上，而这个网络只用一个路由器和互联网连接，那么在这种情况下使用默认路由是非常合适的</span></div></div><div id="tU7at42nhCkwpTEk5J7Hq1" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_15.png" style="width: 100%"/></figure></div><div id="ur2jTresyDZWvhpGJ9ZHhV" class="wolai-block wolai-text"><div><span class="inline-wrap">•IP<span class="jill"></span>分组的首部中没有字段用来指明“下一跳路由器的<span class="jill"></span>IP<span class="jill"></span>地址”</span></div></div><div id="4GVWC4XbTPZD3wHqeDWN2o" class="wolai-block wolai-text"><div><span class="inline-wrap">•当路由器收到待转发的<span class="jill"></span>IP<span class="jill"></span>分组时，不是将下一跳路由器的<span class="jill"></span>IP<span class="jill"></span>地址填入 IP<span class="jill"></span>分组，而是送交下层的网络接口软件</span></div></div><div id="toAnjXj5jTAFG3w7BZiAyJ" class="wolai-block wolai-text"><div><span class="inline-wrap">•网络接口软件使用<span class="jill"></span>ARP<span class="jill"></span>负责将下一跳路由器的<span class="jill"></span>IP<span class="jill"></span>地址转换成硬件地址，并将此硬件地址放在链路层的<span class="jill"></span>MAC<span class="jill"></span>帧的首部，然后根据这个硬件地址找到下一跳路由器</span></div></div><h4 id="xewSFwRkbV23DTL3Lz1MHu" class="wolai-block"><span class="inline-wrap">在路由器上执行分组转发流程</span></h4><div id="i8gR7WMZhDDkvLQTkXWhPj" class="wolai-block wolai-text"><div><span class="inline-wrap">•1）从接收的<span class="jill"></span>IP<span class="jill"></span>分组首部提取目的主机的<span class="jill"></span>IP<span class="jill"></span>地址 D,得出目的网络地址为<span class="jill"></span>N</span></div></div><div id="3YqT7hUpTebkdU91j4eRop" class="wolai-block wolai-text"><div><span class="inline-wrap">•2）若网络<span class="jill"></span>N<span class="jill"></span>与此路由器直接相连，则把<span class="jill"></span>IP<span class="jill"></span>分组直接交付目的主机<span class="jill"></span>D；否则是间接交付，执行<span class="jill"></span>3)</span></div></div><div id="k627ZoL4KxMEEWEDnoxSsP" class="wolai-block wolai-text"><div><span class="inline-wrap">•3）若路由表中有目的地址为<span class="jill"></span>D<span class="jill"></span>的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行<span class="jill"></span>4)</span></div></div><div id="94spi58tPry8eafGWHoz2Q" class="wolai-block wolai-text"><div><span class="inline-wrap">•4）若路由表中有到达网络<span class="jill"></span>N<span class="jill"></span>的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行<span class="jill"></span>5)</span></div></div><div id="qdzEWcLLPXm8ZQhayTL7kw" class="wolai-block wolai-text"><div><span class="inline-wrap">•5）若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行<span class="jill"></span>6)</span></div></div><div id="bMsreMXvzrM5qGQaa68jFk" class="wolai-block wolai-text"><div><span class="inline-wrap">•6）报告转发分组出错</span></div></div><hr id="rqzMUa3YhK8AMDVY6HyX1Y" class="wolai-block"/><div id="gqQLgCsp4uUUsHTNhv4qsH" class="wolai-block wolai-text"><div><span class="inline-wrap">•在不划分子网的两级<span class="jill"></span>IP<span class="jill"></span>地址下，从<span class="jill"></span>IP<span class="jill"></span>地址得出网络地址是个很简单的事</span></div></div><div id="jm73uExdFscWPPHnx81VRM" class="wolai-block wolai-text"><div><span class="inline-wrap">•在划分子网的情况下，从<span class="jill"></span>IP<span class="jill"></span>地址却不能唯一地得出网络地址来</span></div></div><div id="n3bsHZfpdgjCEdpskYva8L" class="wolai-block wolai-text"><div><span class="inline-wrap">•原因是网络地址取决于那个网络所采用的子网掩码，而<span class="jill"></span>IP<span class="jill"></span>首部并没有提供子网掩码的信息</span></div></div><div id="3SLK4AuAALpqJP3pXwRSCd" class="wolai-block wolai-text"><div><span class="inline-wrap">•因此分组转发的算法也必须做相应的改动</span></div></div><hr id="fVfmiruDd85XtyzLD5ucwA" class="wolai-block"/><div id="9swPDRn8qFvnV7jwtEs4Z" class="wolai-block wolai-text"><div><span class="inline-wrap">•在不划分子网的两级<span class="jill"></span>IP<span class="jill"></span>地址下，从<span class="jill"></span>IP<span class="jill"></span>地址得出网络地址是个很简单的事</span></div></div><div id="cvk3XtdBtaesX7vwzaXAke" class="wolai-block wolai-text"><div><span class="inline-wrap">•在划分子网的情况下，从<span class="jill"></span>IP<span class="jill"></span>地址却不能唯一地得出网络地址来</span></div></div><div id="nUHWSgRDekunLzfVFptXfJ" class="wolai-block wolai-text"><div><span class="inline-wrap">•原因是网络地址取决于那个网络所采用的子网掩码，而<span class="jill"></span>IP<span class="jill"></span>首部并没有提供子网掩码的信息</span></div></div><div id="cfARQA8ipGjVYVR1kxzzS" class="wolai-block wolai-text"><div><span class="inline-wrap">•因此分组转发的算法也必须做相应的改动</span></div></div><div id="qv5pRPqvo22x78WChJHami" class="wolai-block wolai-text"><div><span class="inline-wrap">•已知互联网和路由器<span class="jill"></span>R1<span class="jill"></span>中的路由表</span></div></div><div id="9WEiTSBV8VUidAnFWy55op" class="wolai-block wolai-text"><div><span class="inline-wrap">•主机 H1<span class="jill"></span>向 H2<span class="jill"></span>发送分组</span></div></div><div id="r5a8cHHow9MaKTFWGSNsJ9" class="wolai-block wolai-text"><div><span class="inline-wrap">•试讨论<span class="jill"></span>R1<span class="jill"></span>收到 H1<span class="jill"></span>向 H2<span class="jill"></span>发送的分组后查找路由表的过程</span></div></div><div id="nWm7wN5dZtX3K1rnFnZAeV" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_16.png" style="width: 100%"/></figure></div><h2 id="aA8NcRn3h6v6FvsW2748b4" class="wolai-block"><span class="inline-wrap">优点</span></h2><div id="4p8kUwCahsbyyqs4MrH8JE" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_17.png" style="width: 100%"/></figure></div><div id="wABWRdkyzjk3ZgVitXkkr5" class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>