<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/wolai.css"/><title>图解ARP协议（二）ARP攻击篇 - 知乎 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="图解ARP协议（二）ARP攻击篇 - 知乎" class="main-title"></div></div></header><article><div id="6tXCLuS4bwqkH7R5AoS2ER" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>一、ARP<span class="jill"></span>攻击概述</b></span></div></div><div id="bvfGhHBS5SVkukKGihLQWz" class="wolai-block wolai-text"><div><span class="inline-wrap">在上篇文章里，我给大家普及了<span class="jill"></span>ARP<span class="jill"></span>协议的基本原理，包括<span class="jill"></span>ARP<span class="jill"></span>请求应答、数据包结构以及协议分层标准，今天我们继续讨论大家最感兴趣的话题：</span><span class="inline-wrap"><b>ARP<span class="jill"></span>攻击原理是什么？通过<span class="jill"></span>ARP<span class="jill"></span>攻击可以做什么，账号是否可以被窃取？有哪些常见的<span class="jill"></span>ARP<span class="jill"></span>渗透（攻击）工具可以用来练手？ARP<span class="jill"></span>扫描和攻击有什么区别，底层数据包特征是怎样的？</b></span></div></div><div id="i3ymuydMwx3kvpJy93wCua" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来，我们通过图解的方式来深入了解<span class="jill"></span>ARP<span class="jill"></span>攻击是如何实现的。</span></div></div><div id="49YbWTGuBqvM7L3gDbkjQi" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>二、ARP<span class="jill"></span>攻击原理</b></span></div></div><div id="bH9pWd2DENSh6HNWrtFSH8" class="wolai-block wolai-text"><div><span class="inline-wrap">但凡局域网存在<span class="jill"></span>ARP<span class="jill"></span>攻击，都说明网络存在&quot;中间人&quot;，我们可以用下图来解释。</span></div></div><div id="f7MQx8G4uw4EuSZzv4fruF" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic4.zhimg.com/v2-816508f970cea1daf14f0610569c53db_b.jpg"/></figure></div><div id="4oRDXDTRrtUsa5L3gq5QbX" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个局域网里面，PC1、PC2、PC3<span class="jill"></span>三台主机共同连接到交换机<span class="jill"></span>SW1<span class="jill"></span>上面，对应<span class="jill"></span>3<span class="jill"></span>个接口<span class="jill"></span>port1/2/3。假设<span class="jill"></span>PC3<span class="jill"></span>这台主机安装了<span class="jill"></span>ARP<span class="jill"></span>攻击软件或遭受<span class="jill"></span>ARP<span class="jill"></span>病毒，成为这个网络的攻击者（hacker），接下来，PC3<span class="jill"></span>是如何攻击的？先不急，先来回顾下<span class="jill"></span>PC1<span class="jill"></span>和<span class="jill"></span>PC2<span class="jill"></span>是如何通信的。</span></div></div><div id="8XXSMu8fLitT3fX83VCsV6" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic1.zhimg.com/v2-6522b0e3e1b7e7058152e70953428c74_b.jpg"/></figure></div><div id="2mWCorCdt9sE9eX63oNQTu" class="wolai-block wolai-text"><div><span class="inline-wrap">①PC1<span class="jill"></span>需要跟<span class="jill"></span>PC2<span class="jill"></span>通信，通过<span class="jill"></span>ARP<span class="jill"></span>请求包询问<span class="jill"></span>PC2<span class="jill"></span>的<span class="jill"></span>MAC<span class="jill"></span>地址，由于采用广播形式，所以交换机将<span class="jill"></span>ARP<span class="jill"></span>请求包从接口<span class="jill"></span>P1<span class="jill"></span>广播到<span class="jill"></span>P2<span class="jill"></span>和<span class="jill"></span>PC3。（注：</span><span class="inline-wrap"><b>交换机收到广播/组播/未知帧都会其他接口泛洪</b></span><span class="inline-wrap">）</span></div></div><div id="czbFpHAuYz8sRZUj7P3vv5" class="wolai-block wolai-text"><div><span class="inline-wrap">②PC2<span class="jill"></span>根据询问信息，返回<span class="jill"></span>ARP<span class="jill"></span>单播回应包；此时<span class="jill"></span>PC3<span class="jill"></span>作为攻击者，没有返回<span class="jill"></span>ARP<span class="jill"></span>包，但是处于&quot;</span><span class="inline-wrap"><b>监听</b></span><span class="inline-wrap">&quot;状态，为后续攻击做准备。</span></div></div><div id="aXCH16r7eayDTrms1pFCdQ" class="wolai-block wolai-text"><div><span class="inline-wrap">③PC1<span class="jill"></span>和<span class="jill"></span>PC2<span class="jill"></span>根据<span class="jill"></span>ARP<span class="jill"></span>问答，将各自的<span class="jill"></span>ARP<span class="jill"></span>映射信息（IP-MAC）存储在本地<span class="jill"></span>ARP<span class="jill"></span>缓存表。</span></div></div><div id="9qbxqfGjbKSFFx1dConkc" class="wolai-block wolai-text"><div><span class="inline-wrap">④交换机根据其学习机制，记录<span class="jill"></span>MAC<span class="jill"></span>地址对应的接口信息，存储在</span><span class="inline-wrap"><b>CAM<span class="jill"></span>缓存表</b></span><span class="inline-wrap">（也称为<span class="jill"></span>MAC<span class="jill"></span>地址表）。交换机收到数据包时，会解封装数据包，根据</span><span class="inline-wrap"><b>目标<span class="jill"></span>MAC</b></span><span class="inline-wrap">字段进行转发。</span></div></div><div id="fcBnPWqeFg83gQVhiSaHuj" class="wolai-block wolai-text"><div><span class="inline-wrap">关于上面的图解，我们要记住这些关键知识（敲黑板！）：</span></div></div><div id="7PTVpchvRqi5fbqYhK6yQ4" class="wolai-block wolai-text"><div><span class="inline-wrap">①主机通信需要查找<span class="jill"></span>ARP<span class="jill"></span>表，而交换机通信需要查找<span class="jill"></span>CAM<span class="jill"></span>表（路由器则查找<span class="jill"></span>Route<span class="jill"></span>表）。</span></div></div><div id="hDNcdMVt1fia7Z5i8dodbr" class="wolai-block wolai-text"><div><span class="inline-wrap">注：ARP<span class="jill"></span>表：ip&lt;-&gt;mac CAM<span class="jill"></span>表：mac&lt;-&gt;port （Route<span class="jill"></span>表：route&lt;-&gt;port）</span></div></div><div id="mzoY2vSGYwqRej6o2WZyAr" class="wolai-block wolai-text"><div><span class="inline-wrap">②交换机基于源<span class="jill"></span>MAC<span class="jill"></span>地址学习，基于目的<span class="jill"></span>MAC<span class="jill"></span>地址转发。</span></div></div><div id="oFyvhVkqE8u6r16bPjmhec" class="wolai-block wolai-text"><div><span class="inline-wrap">③同一局域网内，攻击者可以根据主机的<span class="jill"></span>ARP<span class="jill"></span>广播请求监听其<span class="jill"></span>IP<span class="jill"></span>和<span class="jill"></span>MAC<span class="jill"></span>信息。</span></div></div><div id="n3KnzV6WEmndYAjqXjNvNz" class="wolai-block wolai-text"><div><span class="inline-wrap">注：这里是&quot;被动监听&quot;，跟后面要谈到的&quot;主动扫描&quot;，原理上有区分，这里先埋个坑）</span></div></div><div id="59nMFHjfyqv8wKFwiYMrsX" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来是重点，我们来看看<span class="jill"></span>PC3（Hacker）是如何发起<span class="jill"></span>ARP<span class="jill"></span>攻击的=&gt;</span></div></div><div id="9dqzKfNWbJmnYBqymRByi" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic1.zhimg.com/v2-383f86e253b689d40ff20d648ce7afac_b.jpg"/></figure></div><div id="t7rYXrRqpitVWKq9PpwBf8" class="wolai-block wolai-text"><div><span class="inline-wrap">正常情况下，若收到的<span class="jill"></span>ARP<span class="jill"></span>请求不是给自己的，则直接丢弃；而这里<span class="jill"></span>PC3（Hacker）在监听之后，发起了<span class="jill"></span>ARP<span class="jill"></span>回应包：</span><span class="inline-wrap"><b>我就是<span class="jill"></span>PC2（IP2-MAC3）</b></span><span class="inline-wrap">。</span></div></div><div id="2unPUTGBZumkD2Ti5XnAvg" class="wolai-block wolai-text"><div><span class="inline-wrap">从拓扑可以出现，PC3<span class="jill"></span>明明是<span class="jill"></span>IP3<span class="jill"></span>对应<span class="jill"></span>MAC3，很显然这就是一个<span class="jill"></span>ARP<span class="jill"></span>欺骗行为。于此同时，PC2<span class="jill"></span>正常的<span class="jill"></span>ARP<span class="jill"></span>回应包也交到了<span class="jill"></span>PC1<span class="jill"></span>手中，我们来看<span class="jill"></span>PC1<span class="jill"></span>接下来如何处理的：</span></div></div><div id="nGcgyz1fBrtz6Lys7NtMtM" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic2.zhimg.com/v2-d234cb3ec99e072f16c7000358284641_b.jpg"/></figure></div><div id="jJzFzQUtm6myRW2FkF2wiP" class="wolai-block wolai-text"><div><span class="inline-wrap">PC1<span class="jill"></span>收到两个<span class="jill"></span>ARP<span class="jill"></span>回应包，内容分别如下：</span></div></div><div id="wWJkEm2rMbgFYCoWB85bdZ" class="wolai-block wolai-text"><div><span class="inline-wrap">③我是<span class="jill"></span>PC2，我的<span class="jill"></span>IP<span class="jill"></span>地址是</span><span class="inline-wrap"><b>IP2</b></span><span class="inline-wrap">，我的<span class="jill"></span>MAC<span class="jill"></span>地址是</span><span class="inline-wrap"><b>MAC2</b></span><span class="inline-wrap">；</span></div></div><div id="rM82ziV5GF2NYF8hbSvajy" class="wolai-block wolai-text"><div><span class="inline-wrap">③我是<span class="jill"></span>PC2，我的<span class="jill"></span>IP<span class="jill"></span>地址是</span><span class="inline-wrap"><b>IP2</b></span><span class="inline-wrap">，我的<span class="jill"></span>MAC<span class="jill"></span>地址是</span><span class="inline-wrap"><b>MAC3</b></span><span class="inline-wrap">；</span></div></div><div id="sxLNcJZitWshqUt5XMYF5A" class="wolai-block wolai-text"><div><span class="inline-wrap">PC1<span class="jill"></span>一脸懵：</span><span class="inline-wrap"><b>咋回事？还有这操作？不管了，我选最新的！（后到优先）</b></span></div></div><div id="6naizkzM5F2g3hPkdBdpH5" class="wolai-block wolai-text"><div><span class="inline-wrap">这里给大家顺便普及下网络协议里各种表在处理缓存信息的方式：</span></div></div><div id="7BaGg7hvQpjWdebK7myLxi" class="wolai-block wolai-text"><div><span class="inline-wrap">要么&quot;先到先得&quot;，要么&quot;后到优先&quot;。上面提到的<span class="jill"></span>ARP<span class="jill"></span>和<span class="jill"></span>CAM<span class="jill"></span>表，就是遵循&quot;后到优先&quot;原则，而后面章节我们会讲到的<span class="jill"></span>DHCP<span class="jill"></span>表，则遵循&quot;先到先得&quot;原则。</span></div></div><div id="ow2aGnnYQ8GFyDi6tFqrph" class="wolai-block wolai-text"><div><span class="inline-wrap">那么问题来了，上面两个<span class="jill"></span>ARP<span class="jill"></span>回应包到底哪个先到哪个后到呢？</span></div></div><div id="kq8dK1BCALALMXP8XNvE4s" class="wolai-block wolai-text"><div><span class="inline-wrap">作为初学者，可能还在纠结前后这种<span class="jill"></span>naive<span class="jill"></span>的问题；而作为<span class="jill"></span>hacker，只要持续不停发出<span class="jill"></span>ARP<span class="jill"></span>欺骗包，就一定能够覆盖掉正常的<span class="jill"></span>ARP<span class="jill"></span>回应包。</span><span class="inline-wrap"><b>稳健的<span class="jill"></span>ARP<span class="jill"></span>嗅探/渗透工具，能在短时间内高并发做网络扫描（例如<span class="jill"></span>1<span class="jill"></span>秒钟成千上百的数据包），能够持续对外发送欺骗包。</b></span><span class="inline-wrap"> </span></div></div><div id="wsJ4NeyH2LhfdQUNzfr7XQ" class="wolai-block wolai-text"><div><span class="inline-wrap">无论如何，当<span class="jill"></span>PC1<span class="jill"></span>和<span class="jill"></span>PC2<span class="jill"></span>这种&quot;小白&quot;用户遇到<span class="jill"></span>PC3（hacker）时，最终的结果一定是这样的：</span></div></div><div id="bxd54XQVdPgBMmhuPxz4YV" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic2.zhimg.com/v2-f898793fd3a4f37272dfc31d2ecbaa55_b.jpg"/></figure></div><div id="7Nt2Qdj3ztzDF9GYZfDjC5" class="wolai-block wolai-text"><div><span class="inline-wrap">小白 vs 黑客，很明显的较量，PC1<span class="jill"></span>最终记录的是虚假的<span class="jill"></span>ARP<span class="jill"></span>映射：IP2&lt;-&gt;MAC3，得到错误信息的<span class="jill"></span>PC1，接下来会发生什么情况呢？（我们以<span class="jill"></span>PC1 ping PC2<span class="jill"></span>为例）</span></div></div><div id="7ihFTchzVyRXx4wQZegC1k" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic1.zhimg.com/v2-bade17b91e12c9f9ad5536858abf1350_b.jpg"/></figure></div><div id="ijmBCfxNjXv58QScTi945E" class="wolai-block wolai-text"><div><span class="inline-wrap">根据数据封装规则，当<span class="jill"></span>PC1<span class="jill"></span>要跟<span class="jill"></span>PC2<span class="jill"></span>进行通信时，无论是发生<span class="jill"></span>PING<span class="jill"></span>包还是发送其他数据，首先要查找<span class="jill"></span>ARP<span class="jill"></span>表，然后在网络层打上源目<span class="jill"></span>IP，在链路层打上源目<span class="jill"></span>MAC，然后将数据包发送给交换机。交换机收到之后对数据进行解封装，并且查看<span class="jill"></span>CAM<span class="jill"></span>表（基于目的<span class="jill"></span>MAC<span class="jill"></span>转发），由于目标<span class="jill"></span>MAC3<span class="jill"></span>对应<span class="jill"></span>Port3，所以交换机自然而然将其转发给<span class="jill"></span>PC3。</span></div></div><div id="pPgggeXgvUAPrHXMRuYMMz" class="wolai-block wolai-text"><div><span class="inline-wrap">就这样，PC1<span class="jill"></span>本来要发给<span class="jill"></span>PC2<span class="jill"></span>的数据包，落到了<span class="jill"></span>PC3（Hacker）手里，这就完成了一次完整的<span class="jill"></span>ARP<span class="jill"></span>攻击。反过来，</span><span class="inline-wrap"><b>如果<span class="jill"></span>PC2<span class="jill"></span>要将数据包发送给<span class="jill"></span>PC1，PC3<span class="jill"></span>仍然可以以同样的<span class="jill"></span>ARP<span class="jill"></span>欺骗实现攻击</b></span><span class="inline-wrap">，这就有了下面这张图（PC3<span class="jill"></span>既欺骗了<span class="jill"></span>PC1，也欺骗了<span class="jill"></span>PC2）。</span></div></div><div id="rUcGjQSaPzx2VdMMJi4kqN" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic2.zhimg.com/v2-317858c5badea87786011cb8eda6d3fd_b.jpg"/></figure></div><div id="iF5Z88MXTeVvuL1r74gPDN" class="wolai-block wolai-text"><div><span class="inline-wrap">此时，PC1<span class="jill"></span>和<span class="jill"></span>PC2<span class="jill"></span>的通信数据流被<span class="jill"></span>PC3<span class="jill"></span>拦截，形成了典型的&quot;</span><span class="inline-wrap"><b>中间人攻击</b></span><span class="inline-wrap">&quot;。那么，一旦被攻击并拦截，攻击者能做什么，普通用户又会遭受什么损失？这里给大家举几个常见的例子=&gt;</span></div></div><div id="c68KLvJ12jNCXNcQ2BiMGk" class="wolai-block wolai-text"><div><span class="inline-wrap">①攻击者既然操控了数据流，那么直接断开通信是轻而易举的，即**&quot;断网攻击&quot;**，例如，PC1<span class="jill"></span>发给<span class="jill"></span>PC2<span class="jill"></span>的数据在<span class="jill"></span>PC3<span class="jill"></span>这里可以直接丢弃，而如果这里的<span class="jill"></span>PC2<span class="jill"></span>是一台出口路由器（无线路由器），那就意味着<span class="jill"></span>PC1<span class="jill"></span>直接无法连上互联网。</span></div></div><div id="2hEmLT3snrKGSgPtSHGn7q" class="wolai-block wolai-text"><div><span class="inline-wrap">②&quot;断网攻击&quot;显然容易被发现，而且比较&quot;残忍&quot;，所以就有了更加常见的应用-</span><span class="inline-wrap"><b>&quot;限速&quot;</b></span><span class="inline-wrap">。例如，在宿舍上网突然很慢，在网吧上网突然打不开网页，如果这个网络没有安全防御，那么很有可能有&quot;内鬼&quot;。</span></div></div><div id="dR6e455353PiBrDtWyMtw7" class="wolai-block wolai-text"><div><span class="inline-wrap">③其实无论是&quot;断网攻击&quot;还是&quot;限速&quot;，整体还是比较&quot;善良&quot;，因为这里流量里面的核心数据还没有被&quot;提取&quot;出来。如果攻击者是一名真正的黑客，他的目的一定不会这么无聊，因为内网流量对于黑客是没有太大价值的，而只有**&quot;用户隐私&quot;**，例如常见网站的登录账号密码，这些才是最有价值的。</span></div></div><div id="udveoVQkUkJSvki2hDretv" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>问：遭受<span class="jill"></span>ARP<span class="jill"></span>攻击之后，哪些账号可能被窃取？</b></span></div></div><div id="qD1WuqvNCtQLJE16ks7LVk" class="wolai-block wolai-text"><div><span class="inline-wrap">答：</span><span class="inline-wrap"><b>任何基于明文传输的应用，都可以被窃取。</b></span><span class="inline-wrap"> 例如，如果一个网站不是<span class="jill"></span>HTTPS<span class="jill"></span>协议，而是基于<span class="jill"></span>HTTP<span class="jill"></span>明文传输，那么当你登录这个网站时，你的密码就会被窃取。除了<span class="jill"></span>http（web<span class="jill"></span>应用），常见的还有<span class="jill"></span>telnet、ftp、pop3/smtp/imap（邮箱）等应用，都很容易泄露密码。</span></div></div><div id="2GEwFN8zPfwAjjQDBndyUz" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>三、常见<span class="jill"></span>ARP<span class="jill"></span>渗透工具与底层原理分析</b></span></div></div><div id="3FQdJTzHyP2jkfN8JCNLjs" class="wolai-block wolai-text"><div><span class="inline-wrap">基于<span class="jill"></span>ARP<span class="jill"></span>欺骗原理设计出来的渗透/攻击工具非常多，而最终能实现什么功能则各有差异，简单举几个例子：</span></div></div><div id="iJKXzXFscvmpHhvvJeuhy6" class="wolai-block wolai-text"><div><span class="inline-wrap">①无毒无害型的</span><span class="inline-wrap"><b>仅具备<span class="jill"></span>ARP<span class="jill"></span>扫描</b></span><span class="inline-wrap">功能，用来发现内网主机；例如<span class="jill"></span>Metasploit<span class="jill"></span>里面的<span class="jill"></span>arping/arpscan<span class="jill"></span>相关模块；</span></div></div><div id="kNM9TKQ8crsdAbs7DPhu9x" class="wolai-block wolai-text"><div><span class="inline-wrap">②</span><span class="inline-wrap"><b>ARP<span class="jill"></span>扫描<span class="jill"></span>+<span class="jill"></span>流量控制</b></span><span class="inline-wrap">（限速或限制能上哪些网站和应用）；例如<span class="jill"></span>Windows<span class="jill"></span>下的<span class="jill"></span>P2P<span class="jill"></span>终结者；</span></div></div><div id="dCt64adLsYAV89ZLczcwXq" class="wolai-block wolai-text"><div><span class="inline-wrap">③</span><span class="inline-wrap"><b>ARP<span class="jill"></span>扫描<span class="jill"></span>+<span class="jill"></span>账号窃取</b></span><span class="inline-wrap">（网站、邮箱、各种）；最强的莫过于<span class="jill"></span>Windows<span class="jill"></span>下的<span class="jill"></span>Cain，当然还有跨平台的<span class="jill"></span>Ettercap（需配合其他工具）；</span></div></div><div id="hxQNAQ2WiDJdkayinCXafw" class="wolai-block wolai-text"><div><span class="inline-wrap">当然，如果攻击者足够强悍，也可以基于协议底层原理，编写自己的<span class="jill"></span>ARP<span class="jill"></span>工具。这里我</span><span class="inline-wrap"><b>通过<span class="jill"></span>wirehshark<span class="jill"></span>给大家还原真实网络中常见的<span class="jill"></span>ARP<span class="jill"></span>扫描和欺骗攻击</b></span><span class="inline-wrap">（具体的软件使用这里暂时不出现，大家重点关注底层实现）。</span></div></div><div id="hqR9vhysRsgZHuaywkMsqf" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic2.zhimg.com/v2-af057558ef563955ede46f22ea77c335_b.jpg"/></figure></div><div id="phaiKevw113KjF86LwT78F" class="wolai-block wolai-text"><div><span class="inline-wrap">在这张图里面，Hacker（就是我...）接入了一个<span class="jill"></span>WiFi<span class="jill"></span>网络，这个<span class="jill"></span>10.1.20.0/24<span class="jill"></span>便是所在的网段。刚进来一个陌生网络，Hacker<span class="jill"></span>只知道自己的<span class="jill"></span>IP<span class="jill"></span>信息，例如<span class="jill"></span>IP<span class="jill"></span>地址是<span class="jill"></span>10.1.20.253，网关地址是<span class="jill"></span>10.1.20.254，而这个局域网的其他设备是什么？有多少台？地址分布是多少？Hacker<span class="jill"></span>都不知道，接下来怎么办呢？是不是要直接发动<span class="jill"></span>ARP<span class="jill"></span>攻击了？</span></div></div><div id="iyDmYnkdFvnSkFKra6Ynhk" class="wolai-block wolai-text"><div><span class="inline-wrap">不用这么着急，咋们至少要先了解下这个网络，进行基本的</span><span class="inline-wrap"><b>扫描和踩点</b></span><span class="inline-wrap">。这个时候通过<span class="jill"></span>ARP<span class="jill"></span>工具对这个<span class="jill"></span>WiFi<span class="jill"></span>网络进行扫描，具体的数据包截图如下：</span></div></div><div id="6yBZLJRaYpzD7yWJwX8pXn" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic4.zhimg.com/v2-4be85864ff433d20b9e1165fe7cc36c3_b.jpg"/></figure></div><div id="aTD4CUFckdkmXSN2VwphoQ" class="wolai-block wolai-text"><div><span class="inline-wrap">上面的<span class="jill"></span>ARP<span class="jill"></span>扫描过程，大概的情况是这样的=&gt;</span></div></div><div id="sPR3QgHzCkTzoyXWyyESf3" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic4.zhimg.com/v2-bc0c22f0043748b52cceaf185804694b_b.jpg"/></figure></div><div id="jPm4863eYNnwkFC6rzTi7i" class="wolai-block wolai-text"><div><span class="inline-wrap">其实，这就是典型的&quot;盲扫&quot;或者&quot;暴力扫描&quot;：反正我不知道网络到底有多少主机，那我就尝试一下把整个网段全部问一遍得了。</span><span class="inline-wrap"><b>好比老师上课点名，把每个学生的桌位号念一遍，谁举手就到勤，没举手就算逃课。</b></span><span class="inline-wrap"> </span></div></div><div id="oxwSHrJ4Rg3JjHye6SPJV4" class="wolai-block wolai-text"><div><span class="inline-wrap">那么，这个实际网络里面，到底谁&quot;举手&quot;了呢？我们来看<span class="jill"></span>Wireshark<span class="jill"></span>抓包情况。</span></div></div><div id="9Srtu6ijo2tR8aHzao6aUp" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic3.zhimg.com/v2-c2b83eee5c96827c133c45a25d570c56_b.jpg"/></figure></div><div id="gDw1vP9GVfNo4xyyxGawdP" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>ARP<span class="jill"></span>应答信息里面，除了<span class="jill"></span>IP<span class="jill"></span>地址和<span class="jill"></span>MAC<span class="jill"></span>信息，我们还能看到相关的设备厂商信息，例如<span class="jill"></span>cisco、meizu、apple、xiaomi<span class="jill"></span>等，这其实就是依靠<span class="jill"></span>MAC<span class="jill"></span>地址前面<span class="jill"></span>24<span class="jill"></span>位的**OUI（机构唯一标识符）**来识别的。</span></div></div><div id="nwPjz6UMnXBQg1nNrFhHpJ" class="wolai-block wolai-text"><div><span class="inline-wrap">Wireshark<span class="jill"></span>或扫描器能够帮我们将<span class="jill"></span>OUI<span class="jill"></span>转为对应的厂商（还有一些扫描器基于<span class="jill"></span>Netbios<span class="jill"></span>协议，还能找到电脑的主机名），所以，扫描之后可以得到下面这张图片=&gt;</span></div></div><div id="rkP7TGS2mJkjJCPETVRXTM" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic3.zhimg.com/v2-0f25c1953baf27d3770c4267ee5d5972_b.jpg"/></figure></div><div id="quXRPbKXXGbCJG7vYuK9zn" class="wolai-block wolai-text"><div><span class="inline-wrap">通过扫描，我们已经知道了整个网络的主机信息，例如<span class="jill"></span>20.254<span class="jill"></span>对应<span class="jill"></span>cisco，应该是路由器，20.248<span class="jill"></span>对应<span class="jill"></span>apple，是苹果手机，20.249<span class="jill"></span>对应<span class="jill"></span>xiaomi，是小米手机，以此类推.....</span></div></div><div id="jFdmoZEgiXcKYNpFzDsvD1" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来，如何进行<span class="jill"></span>ARP<span class="jill"></span>欺骗攻击呢？这里将最重点的数据包截取出来=&gt;</span></div></div><div id="ok8Cjhga92YhLxEXMKtW4L" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic1.zhimg.com/v2-2788e3e061f7ee8af394dea99a5e732c_b.jpg"/></figure></div><div id="hrLNJDC15SkdtHHCBFuwmi" class="wolai-block wolai-text"><div><span class="inline-wrap">根据之前的信息，我们知道<span class="jill"></span>00:08:ca:86:f8:0f<span class="jill"></span>其实就是<span class="jill"></span>hacker<span class="jill"></span>的<span class="jill"></span>mac<span class="jill"></span>地址，并且对应的真正的<span class="jill"></span>IP<span class="jill"></span>地址应该是<span class="jill"></span>10.1.20.253。而这里很明显是</span><span class="inline-wrap"><b>hacker<span class="jill"></span>在欺骗局域网其他主机，它对外声称：自己就是&quot;所有人&quot;</b></span><span class="inline-wrap">。尤其是上面标红的主机，我们已经知道是小米、思科、苹果等设备，但是<span class="jill"></span>hacker<span class="jill"></span>都声明是自己！这样做的意义在于覆盖掉其他主机的<span class="jill"></span>ARP<span class="jill"></span>缓存表信息，并生成错误的<span class="jill"></span>ARP<span class="jill"></span>映射，最终将通信流量交给<span class="jill"></span>hacker。</span></div></div><div id="9tazfghCiMPPsNacrgZoEC" class="wolai-block wolai-text"><div><span class="inline-wrap">当然，还有另外一种<span class="jill"></span>ARP<span class="jill"></span>欺骗的做法：</span><span class="inline-wrap"><b>hacker<span class="jill"></span>告诉所有人，自己就是网关</b></span><span class="inline-wrap">。因为其他主机访问互联网必经之路便是网关（出口路由器/无线路由器），通过这种方式，同样可以截取到用户数据流，这里给出另外一个网络的实现过程=&gt;</span></div></div><div id="g6vTGSD2qdrDzPSVmyNEKH" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Hacker<span class="jill"></span>欺骗主机<span class="jill"></span>Honhai，告诉它：我就是网关（10.1.1.254）</b></span></div></div><div id="mXsr2n4kuqc2KR8BVugWep" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic4.zhimg.com/v2-412742914a0c84bb53a020e66a771ecb_b.jpg"/></figure></div><div id="njhKzP1VXZrg2SGC8HXkxK" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Hacker<span class="jill"></span>欺骗主机<span class="jill"></span>Apple，告诉它：我就是网关（10.1.1.254）</b></span></div></div><div id="h4v97qzJn6HWcC7hNETHva" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic1.zhimg.com/v2-1185c84e361ae6e5be13a78d917cec20_b.jpg"/></figure></div><div id="hT3t8LW999TVP7Y8HvcwD4" class="wolai-block wolai-text"><div><span class="inline-wrap">依此类推，Hacker<span class="jill"></span>会告诉局域网所有主机：自己就是网关，并且后续可以把数据都丢给我，我来转发到互联网。</span></div></div><div id="hAhFSdNvLNuTXvh6CP2V6N" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>四、ARP<span class="jill"></span>攻击总结</b></span></div></div><div id="roNpo5mYnBk4BhtTzS4R8C" class="wolai-block wolai-text"><div><span class="inline-wrap">①ARP<span class="jill"></span>缓存表基于&quot;后到优先&quot;原则，IP<span class="jill"></span>与<span class="jill"></span>MAC<span class="jill"></span>的映射信息能被覆盖；</span></div></div><div id="5geiipKk6JdAVzHt3qzE8H" class="wolai-block wolai-text"><div><span class="inline-wrap">②ARP<span class="jill"></span>攻击基于伪造的<span class="jill"></span>ARP<span class="jill"></span>回应包，黑客通过构造&quot;错位&quot;的<span class="jill"></span>IP<span class="jill"></span>和<span class="jill"></span>MAC<span class="jill"></span>映射，覆盖主机的<span class="jill"></span>ARP<span class="jill"></span>表（也被称为&quot;ARP<span class="jill"></span>毒化&quot;），最终截取用户的数据流；</span></div></div><div id="4J1gebtniE1ecMDQm88D4A" class="wolai-block wolai-text"><div><span class="inline-wrap">③一旦遭受<span class="jill"></span>ARP<span class="jill"></span>攻击，账号密码都可能被窃取（如果通信协议不是加密的）；</span></div></div><div id="buNTTkzUxAbJSVgynSkUpu" class="wolai-block wolai-text"><div><span class="inline-wrap">④通过<span class="jill"></span>Wireshark<span class="jill"></span>数据包分析，我们掌握了真实网络中<span class="jill"></span>ARP<span class="jill"></span>底层攻击原理及数据包组成。</span></div></div><div id="f7wk5sPe589bBTvknNn41b" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>预告：ARP<span class="jill"></span>防御篇</b></span></div></div><div id="GWRcBCYUKao7XxqmMhnZA" class="wolai-block wolai-text"><div><span class="inline-wrap">如何防御<span class="jill"></span>ARP<span class="jill"></span>攻击？</span></div></div><div id="qaq8ku5WcTjWafqqFeyNcN" class="wolai-block wolai-text"><div><span class="inline-wrap">有哪些<span class="jill"></span>ARP<span class="jill"></span>防御软件？</span></div></div><div id="7RkSSu8gySkPP27zYXDTmK" class="wolai-block wolai-text"><div><span class="inline-wrap">如果被<span class="jill"></span>ARP<span class="jill"></span>攻击了，如何揪出&quot;内鬼&quot;，应该如何&quot;还手&quot;？</span></div></div><div id="hcHjP9KdJdHMyCS3vMFRAe" class="wolai-block wolai-text"><div><span class="inline-wrap">企业网/家庭网的防御方法有什么区别？</span></div></div><div id="5iSpsyUo3Ak7m8QaXXWGGZ" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>【相关推荐】</b></span><span class="inline-wrap"> </span></div></div><div id="7HoHMs3Uw4p9UgcybcoaXC" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://zhuanlan.zhihu.com/p/28771785"><span>图解<span class="jill"></span>ARP<span class="jill"></span>协议（一）</span></a></span></div></div><div id="nQX1xSk6hntb39CwAPpeNp" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://link.zhihu.com/?target=http%3A//www.pinginglab.net/course/164"><span>《TCP/IP<span class="jill"></span>协议栈视频教程》</span></a></span></div></div><div id="wTC1QJL3WHw343mr7xgbhb" class="wolai-block wolai-text"><div><span class="inline-wrap">新浪微博：</span><span class="inline-wrap"><a href="https://link.zhihu.com/?target=http%3A//www.weibo.com/jaykingchen"><span>@<span class="jill"></span>拼客学院陈鑫杰</span></a></span></div></div><div id="i625ajhDKWr8qbxqjsuJDG" class="wolai-block wolai-text"><div><span class="inline-wrap">微信公众号：拼客院长陈鑫杰</span></div></div><div id="xiKPdTSsKcam59mzAVXN46" class="wolai-block wolai-text"><div><span class="inline-wrap">拼客学院：</span><span class="inline-wrap"><a href="https://link.zhihu.com/?target=http%3A//www.pinginglab.net"><span>http://www.pinginglab.net</span></a></span></div></div></article><footer></footer></body></html>