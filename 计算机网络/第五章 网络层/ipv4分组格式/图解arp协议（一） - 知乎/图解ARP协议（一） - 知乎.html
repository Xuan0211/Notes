<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>图解ARP协议（一） - 知乎 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="图解ARP协议（一） - 知乎" class="main-title"></div></div></header><article><h2 id="xjAUwv6Ymo9Zpd45mHb5bP" class="wolai-block"><span class="inline-wrap"><b>一、ARP<span class="jill"></span>概述</b></span></h2><div id="p4jqRtxuKdWvVF91Q2Y5X5" class="wolai-block wolai-text"><div><span class="inline-wrap">如果要在<span class="jill"></span>TCP/IP<span class="jill"></span>协议栈中选择一个</span><span class="inline-wrap"><b>&quot;最不安全的协议&quot;</b></span><span class="inline-wrap">，那么我会毫不犹豫把票投给<span class="jill"></span>ARP<span class="jill"></span>协议。我们经常听到的这些术语，包括&quot;网络扫描&quot;、&quot;内网渗透&quot;、&quot;中间人拦截&quot;、&quot;局域网流控&quot;、&quot;流量欺骗&quot;，基本都跟<span class="jill"></span>ARP<span class="jill"></span>脱不了干系。大量的安全工具，例如大名鼎鼎的<span class="jill"></span>Cain、功能完备的<span class="jill"></span>Ettercap、操作傻瓜式的<span class="jill"></span>P2P<span class="jill"></span>终结者，底层都要基于<span class="jill"></span>ARP<span class="jill"></span>实现。</span></div></div><div id="8s2ki4rEcNge9HX2nZQRj5" class="wolai-block wolai-text"><div><span class="inline-wrap">听上去这么&quot;逆天&quot;的协议，其实技术原理又简单的难以置信，例如<span class="jill"></span>ARP<span class="jill"></span>整个完整交互过程仅需要两个包，一问一答即可搞定！但是<span class="jill"></span>ARP<span class="jill"></span>协议也有它令初学者迷惑的地方，例如由它本身延伸出来的&quot;代理<span class="jill"></span>ARP&quot;、&quot;免费<span class="jill"></span>ARP&quot;、&quot;翻转<span class="jill"></span>ARP&quot;、&quot;逆向<span class="jill"></span>ARP&quot;，而这些不同种类的<span class="jill"></span>ARP，又应用于不同的场景。好吧，在深入到技术原理之前，作为初学者，我们先记住下面三句话：</span></div></div><div id="v16PtaGscAFgPSHistHRif" class="wolai-block wolai-text"><div><span class="inline-wrap">①</span><span class="inline-wrap"><b>ARP（Address Resolution Protocol）即地址解析协议， 用于实现从 IP 地址到 MAC 地址的映射，即询问目标<span class="jill"></span>IP<span class="jill"></span>对应的<span class="jill"></span>MAC<span class="jill"></span>地址</b></span><span class="inline-wrap">。</span></div></div><div id="yoAbH46iSkoN1F59MBtA3" class="wolai-block wolai-text"><div><span class="inline-wrap">②在网络通信中，主机和主机通信的数据包需要依据<span class="jill"></span>OSI<span class="jill"></span>模型从上到下进行数据封装，当数据封装完整后，再向外发出。所以在局域网的通信中，不仅需要源目<span class="jill"></span>IP<span class="jill"></span>地址的封装，也需要源目<span class="jill"></span>MAC<span class="jill"></span>的封装。</span></div></div><div id="qr5uaXh1VUe2BAom6Yvkyc" class="wolai-block wolai-text"><div><span class="inline-wrap">③一般情况下，上层应用程序更多关心<span class="jill"></span>IP<span class="jill"></span>地址而不关心<span class="jill"></span>MAC<span class="jill"></span>地址，所以需要通过<span class="jill"></span>ARP<span class="jill"></span>协议来获知目的主机的<span class="jill"></span>MAC<span class="jill"></span>地址，完成数据封装。</span></div></div><div id="w7VmZMvKztnPXJ3E4hYRLk" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来，我们通过图解的方式来深入了解<span class="jill"></span>ARP<span class="jill"></span>协议是如何工作的。</span></div></div><h2 id="8E77BFknutEM1Q1Cha4ubM" class="wolai-block"><span class="inline-wrap"><b>二、ARP<span class="jill"></span>原理之请求应答</b></span></h2><div id="oo94qLiYpZQRkiEUyrMJAE" class="wolai-block wolai-text"><div><span class="inline-wrap">同一个局域网里面，当<span class="jill"></span>PC1<span class="jill"></span>需要跟<span class="jill"></span>PC2<span class="jill"></span>进行通信时，此时<span class="jill"></span>PC1<span class="jill"></span>是如何处理的？</span></div></div><div id="45YKsKtELwEhFMF74Wq524" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic2.zhimg.com/v2-e350c54794f261231f784a973708b9e9_b.jpg" style="width: 1046.4px"/></figure></div><div id="qKoeUko6GHArWJ4AtsCg18" class="wolai-block wolai-text"><div><span class="inline-wrap">根据<span class="jill"></span>OSI<span class="jill"></span>数据封装顺序，发送方会自顶向下（从应用层到物理层）封装数据，然后发送出去，这里以<span class="jill"></span>PC1 ping PC2<span class="jill"></span>的过程举例==&gt;</span></div></div><div id="nmskEjP7ZJU7A7fkgBHC9P" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic1.zhimg.com/v2-482e369fa6a8c4246af0164fbc69e2fc_b.jpg" style="width: 576px"/></figure></div><div id="cK9juhaKWtFgy9rb4Fd4hz" class="wolai-block wolai-text"><div><span class="inline-wrap">PC1<span class="jill"></span>封装数据并且对外发送数据时，上图中出现了&quot;failed&quot;，即数据封装失败了，为什么？</span></div></div><div id="6KRTGxzjUDD626ePmzC3jn" class="wolai-block wolai-text"><div><span class="inline-wrap">我们给<span class="jill"></span>PC1<span class="jill"></span>指令-&quot;ping ip2&quot;，这就告知了目的<span class="jill"></span>IP，此时<span class="jill"></span>PC1<span class="jill"></span>便有了通信需要的源目<span class="jill"></span>IP<span class="jill"></span>地址，但是<span class="jill"></span>PC1<span class="jill"></span>仍然没有通信需要的目的<span class="jill"></span>MAC<span class="jill"></span>地址。</span><span class="inline-wrap"><b>这就好比我们要寄一个快递，如果在快递单上仅仅写了收件人的姓名（IP），却没有写收件人的地址（MAC），那么这个快递就没法寄出，因为信息不完整。</b></span><span class="inline-wrap"> </span></div></div><div id="4aWHMLPPkdiDhqyoojh7u8" class="wolai-block wolai-text"><div><span class="inline-wrap">那么，现在<span class="jill"></span>PC1<span class="jill"></span>已经有了<span class="jill"></span>PC2<span class="jill"></span>的<span class="jill"></span>IP<span class="jill"></span>地址信息，如何获取到<span class="jill"></span>PC2<span class="jill"></span>的<span class="jill"></span>MAC<span class="jill"></span>地址呢？此时，ARP<span class="jill"></span>协议就派上用场了。我们接着上面这张图，继续==&gt;</span></div></div><div id="mdQZuKoxxoRD1n2nTJQvBz" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic4.zhimg.com/v2-12c0720dbf1143fb4ace0cb44398508f_b.jpg" style="width: 576px"/></figure></div><div id="8mDKwND8Ef9vBE6aPUjMDp" class="wolai-block wolai-text"><div><span class="inline-wrap">通过第三和第四步骤，我们看到<span class="jill"></span>PC1<span class="jill"></span>和<span class="jill"></span>PC2<span class="jill"></span>进行了一次<span class="jill"></span>ARP<span class="jill"></span>请求和回复过程，通过这个交互工程，PC1<span class="jill"></span>便具备了<span class="jill"></span>PC2<span class="jill"></span>的<span class="jill"></span>MAC<span class="jill"></span>地址信息。</span></div></div><div id="zcAfi4k5Le7KGD1AZi1mr" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来<span class="jill"></span>PC1<span class="jill"></span>会怎么做呢？在真正进行通信之前，PC1<span class="jill"></span>还会将<span class="jill"></span>PC2<span class="jill"></span>的<span class="jill"></span>MAC<span class="jill"></span>信息放入本地的【ARP<span class="jill"></span>缓存表】，表里面放置了<span class="jill"></span>IP<span class="jill"></span>和<span class="jill"></span>MAC<span class="jill"></span>地址的映射信息，例如 IP2&lt;-&gt;MAC2。接下来，PC1<span class="jill"></span>再次进行数据封装，正式进入<span class="jill"></span>PING<span class="jill"></span>通信，如下==&gt;  </span></div></div><div id="aBJezRqmRgAt5ZmBxwBcMJ" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic3.zhimg.com/v2-27582d8469224d8a28ee148cf3543e5e_b.jpg" style="width: 576px"/></figure></div><div id="mgUpryvvSAs5U7hqq2menM" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>小结：</b></span><span class="inline-wrap"> 经过上面<span class="jill"></span>6<span class="jill"></span>个步骤的处理，PC1<span class="jill"></span>终于把数据包发送出去了，之后便可以进行正常的通信了。看到了吧，ARP<span class="jill"></span>的功能和实现过程是如此的简单：它在发送方需要目标<span class="jill"></span>MAC<span class="jill"></span>地址的时及时出手，通过&quot;一问一答&quot;的方式获取到特定<span class="jill"></span>IP<span class="jill"></span>对应的<span class="jill"></span>MAC<span class="jill"></span>地址，然后存储到本地【</span><span class="inline-wrap"><b>ARP<span class="jill"></span>缓存表</b></span><span class="inline-wrap">】，后续需要的话，就到这里查找。</span></div></div><div id="uryXmPGPiMzu82epxbnyiq" class="wolai-block wolai-text"><div><span class="inline-wrap">既然是&quot;缓存&quot;表，意味着它有</span><span class="inline-wrap"><b>时效性</b></span><span class="inline-wrap">，并且如果电脑或者通信设备重启的话，这张表就会</span><span class="inline-wrap"><b>清空</b></span><span class="inline-wrap">；也就是说，如果下次需要通信，又需要进行<span class="jill"></span>ARP<span class="jill"></span>请求。在我们的<span class="jill"></span>windows/macos<span class="jill"></span>系统下，可以通过命令行&quot;</span><span class="inline-wrap"><b>arp -a</b></span><span class="inline-wrap">&quot;查看具体信息=&gt;</span></div></div><div id="utG6rZ9LrTBjtRxEVd7Lhe" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic2.zhimg.com/v2-7f8bdda04b830562b73cf2b3d932f071_b.jpg" style="width: 900.8px"/></figure></div><h2 id="o3B5rY3xRMHH3AAwqAprLs" class="wolai-block"><span class="inline-wrap"><b>三、ARP<span class="jill"></span>原理之广播请求单播回应</b></span></h2><div id="g4Q2u6vXPD5Qg3xdXraJFy" class="wolai-block wolai-text"><div><span class="inline-wrap">上面的图解过程看上去简单又纯粹，好像我们就已经把这个协议的精髓全部<span class="jill"></span>get<span class="jill"></span>到，但其实，我们只是刚揭开了它的面纱，接下来我们才真正进入正题。例如，上面的图解过程中，整个局域网（LAN）只有<span class="jill"></span>PC1<span class="jill"></span>和<span class="jill"></span>PC2<span class="jill"></span>两个主机，所以这个一问一答过程非常的顺畅。</span></div></div><div id="oj6ACFexbjoQGwojoXwd6Y" class="wolai-block wolai-text"><div><span class="inline-wrap">而实际网络中，这个<span class="jill"></span>LAN<span class="jill"></span>可能有几十上百的主机，那么请问，PC1<span class="jill"></span>如何将这个【ARP<span class="jill"></span>请求包】顺利的交给<span class="jill"></span>PC2，而<span class="jill"></span>PC2<span class="jill"></span>又如何顺利的把【ARP<span class="jill"></span>回应包】返回给<span class="jill"></span>PC1? 我们看下面的图：</span></div></div><div id="92kDkMWQZnkr9hKjQ3TBc7" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic1.zhimg.com/v2-504474cb1210f7d4e72d718cd86148c8_b.jpg" style="width: 576px"/></figure></div><div id="37WhmyaZB1XmSjDksEyg7L" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="bVKpJAeLLng681JnTvxqL8" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic3.zhimg.com/v2-83365e93f2f60f5fb83772eca5dc8016_b.jpg" style="width: 576px"/></figure></div><div id="JQ4Y2HhGbNio9fRxs8Rrm" class="wolai-block wolai-text"><div><span class="inline-wrap">为了营造出&quot;几十上百&quot;的效果，这里多添加了<span class="jill"></span>2<span class="jill"></span>个主机进来 ⁄(⁄ ⁄•⁄ω⁄•⁄ ⁄)⁄，并且增加了有线和无线的环境。那么，在多主机环境下，PC1<span class="jill"></span>现在发出的<span class="jill"></span>ARP<span class="jill"></span>请求包，怎么交到<span class="jill"></span>PC2<span class="jill"></span>手里？</span></div></div><div id="w5ZjcaCDx6RV49eySrGyTW" class="wolai-block wolai-text"><div><span class="inline-wrap">这时，ARP<span class="jill"></span>协议就需要采用以太网的&quot;广播&quot;功能：将请求包</span><span class="inline-wrap"><b>以广播的形式</b></span><span class="inline-wrap">发送，交换机或<span class="jill"></span>WiFi<span class="jill"></span>设备（无线路由器）收到广播包时，会将此数据发给同一局域网的其他所有主机。</span></div></div><div id="fvEAXuf4oE63d9doVPF5nW" class="wolai-block wolai-text"><div><span class="inline-wrap">那么，什么是广播？对于初学者而言，我们只需要知道，大部分的广播包，它们有一个共同特征：</span><span class="inline-wrap"><b>二层封装时目的<span class="jill"></span>MAC<span class="jill"></span>是全<span class="jill"></span>f（ffff.ffff.ffff）或三层封装时目的<span class="jill"></span>IP<span class="jill"></span>是全<span class="jill"></span>1（255.255.255.255）</b></span><span class="inline-wrap">。可以这样更方便的记住：目的地址最大的，就是广播。</span></div></div><div id="uVq4DEdSW5PtGgjUHwfgpJ" class="wolai-block wolai-text"><div><span class="inline-wrap">注明：广播根据所在层次可分为二层广播和三层广播，根据发生范围可分为本地广播和定向广播，小伙伴们有兴趣可以自己再去拓展下。</span></div></div><div id="c6WBt8VAKktt1r9nFfurFL" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来我们来看下这个<span class="jill"></span>ARP<span class="jill"></span>广播请求包接下来是如何工作的？</span></div></div><div id="wL7ht2Hnuh6XTkFADiQ9VQ" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic4.zhimg.com/v2-2485a31a69987ced88931c4a876bc4b3_b.jpg" style="width: 576px"/></figure></div><div id="5jaSWouZWiaxPNghckcmpF" class="wolai-block wolai-text"><div><span class="inline-wrap">根据上图我们看到，PC1<span class="jill"></span>发送的请求广播包同时被其他主机收到，然后<span class="jill"></span>PC3<span class="jill"></span>和<span class="jill"></span>PC4<span class="jill"></span>收到之后（发现不是问自己）则丢弃。</span><span class="inline-wrap"><b>而<span class="jill"></span>PC2<span class="jill"></span>收到之后，根据请求包里面的信息（有自己的<span class="jill"></span>IP<span class="jill"></span>地址），判断是给自己的，所以不会做丢弃动作，而是返回<span class="jill"></span>ARP<span class="jill"></span>回应包。</b></span><span class="inline-wrap"> </span></div></div><div id="xtUasQEnePtwPa8ixFaJJe" class="wolai-block wolai-text"><div><span class="inline-wrap">ARP<span class="jill"></span>请求是通过广播方式来实现的，那么，PC2<span class="jill"></span>返回<span class="jill"></span>ARP<span class="jill"></span>回应包，是否也需要通过广播来实现呢？答案是否定的。</span><span class="inline-wrap"><b>大部分网络协议在设计的时候，都需要保持极度克制，不需要的交互就砍掉，能合并的信息就合并，能不用广播就用单播，以此让带宽变得更多让网络变得更快。</b></span><span class="inline-wrap"> </span></div></div><div id="tcwLmh22nFn3aFbtbrFTy9" class="wolai-block wolai-text"><div><span class="inline-wrap">那么，ARP<span class="jill"></span>回应包是如何处理的？这里需要特别关注<span class="jill"></span>ARP<span class="jill"></span>请求包的内容，在上面的图解里面，ARP<span class="jill"></span>请求包的完整信息是：我的<span class="jill"></span>IP<span class="jill"></span>地址是<span class="jill"></span>IP1，MAC<span class="jill"></span>地址是<span class="jill"></span>MAC1，请问谁是<span class="jill"></span>PC2，你的<span class="jill"></span>IP2<span class="jill"></span>对应的<span class="jill"></span>MAC<span class="jill"></span>地址是多少？</span></div></div><div id="nZLdkvYqBJ7oCCdq5cceEb" class="wolai-block wolai-text"><div><span class="inline-wrap">简单来说，</span><span class="inline-wrap"><b>ARP<span class="jill"></span>请求首先有&quot;自我介绍&quot;，然后才是询问</b></span><span class="inline-wrap">。这样的话，PC2<span class="jill"></span>在收到请求之后，就可以将<span class="jill"></span>PC1<span class="jill"></span>的<span class="jill"></span>IP<span class="jill"></span>和<span class="jill"></span>MAC<span class="jill"></span>映射信息存储在本地的【ARP<span class="jill"></span>缓存表】，既然知道<span class="jill"></span>PC1<span class="jill"></span>在哪里，就可以返回<span class="jill"></span>ARP<span class="jill"></span>单播回应包。</span></div></div><div id="eR3RdBTSiDnTgGG7j3XyLH" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic3.zhimg.com/v2-336746c18241ff5e5d8eba2b1ffac1da_b.jpg" style="width: 576px"/></figure></div><div id="dEVce8cFmPTCT2svrdxPyQ" class="wolai-block wolai-text"><div><span class="inline-wrap">这张图我们需要得到两个信息：①被询问者<span class="jill"></span>PC2<span class="jill"></span>先生成了<span class="jill"></span>ARP<span class="jill"></span>映射信息，然后才是询问者<span class="jill"></span>PC1；②PC3<span class="jill"></span>和<span class="jill"></span>PC4<span class="jill"></span>等其他主机，无法收到这个<span class="jill"></span>ARP<span class="jill"></span>回应包，因为是单播形式。</span></div></div><aside id="f35ZcggxGCgybu4qHHGykR" class="green wolai-block"><div data-symbol="🌲" class="icon"></div><span class="inline-wrap"><b>小结：</b></span><span class="inline-wrap"> ARP<span class="jill"></span>协议通过&quot;一问一答&quot;实现交互，但是&quot;问&quot;和&quot;答&quot;都有讲究，&quot;问&quot;是通过广播形式实现，&quot;答&quot;是通过单播形式。</span></aside><h2 id="3ATcSCuFiGifGe87j7BfzT" class="wolai-block"><span class="inline-wrap"><b>四、ARP<span class="jill"></span>数据包解读</b></span></h2><div id="cmEGFDADUnLKSSh6rkdrjM" class="wolai-block wolai-text"><div><span class="inline-wrap">为了让大家更好的理解<span class="jill"></span>ARP<span class="jill"></span>协议以及广播和单播的概念，我们来看一下用<span class="jill"></span>Wireshark<span class="jill"></span>抓取到的真实网络中的<span class="jill"></span>ARP<span class="jill"></span>过程，通过数据包的方式来呈现，地址信息如下，部分<span class="jill"></span>MAC<span class="jill"></span>信息隐去。（建议初学者用<span class="jill"></span>GNS3<span class="jill"></span>配合<span class="jill"></span>Wireshark<span class="jill"></span>来抓取协议包进行分析，相比真实网络更加干净，方便分析）</span></div></div><div id="uyxoPR61t36znFGXBmLV47" class="wolai-block wolai-text"><div><span class="inline-wrap">主机<span class="jill"></span>1 &lt;---&gt; 主机<span class="jill"></span>2</span></div></div><div id="bQd1vK54SofQV4mDna8Cvr" class="wolai-block wolai-text"><div><span class="inline-wrap">主机<span class="jill"></span>1： IP1 10.1.20.64 MAC1：00:08:ca:xx:xx:xx</span></div></div><div id="mggoPiqP6uoCFTywcyBkm" class="wolai-block wolai-text"><div><span class="inline-wrap">主机<span class="jill"></span>2： IP2 10.1.20.109 MAC2：44:6d:57:xx:xx:xx</span></div></div><div id="vPJjyuQySr3guTnF11XgaW" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>【ARP<span class="jill"></span>请求包】</b></span><span class="inline-wrap"> </span></div></div><div id="kZTcta4NV9SeqUWVLWaWCZ" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic3.zhimg.com/v2-5e6176abaacf3839113a116891df9bde_b.jpg" style="width: 576px"/></figure></div><div id="kcFjCMAaSPvqDMaHXs27K5" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>【ARP<span class="jill"></span>回应包】</b></span><span class="inline-wrap"> </span></div></div><div id="r47rGEyYcDoHzefuKUs2xB" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic4.zhimg.com/v2-2216de823ce85a2cb629d2a0c774f9c3_b.jpg" style="width: 576px"/></figure></div><h3 id="8ANEubSikf6ftoC8z5EUGJ" class="wolai-block"><span class="inline-wrap"><b>【ARP<span class="jill"></span>协议字段解读】</b></span><span class="inline-wrap"> </span></h3><div id="pZqhH1mYMU8LBQezrdKgFL" class="wolai-block wolai-text"><div><span class="inline-wrap">Hardware type ：硬件类型，标识链路层协议</span></div></div><div id="ewnRtXP2kBeHfGiAXmzigi" class="wolai-block wolai-text"><div><span class="inline-wrap">Protocol type： 协议类型，标识网络层协议</span></div></div><div id="trb69oRkoJi7EoXonWS7Wn" class="wolai-block wolai-text"><div><span class="inline-wrap">Hardware size ：硬件地址大小，标识<span class="jill"></span>MAC<span class="jill"></span>地址长度，这里是<span class="jill"></span>6<span class="jill"></span>个字节（48bti）</span></div></div><div id="nhwvnm8E8MXoonjULsYyVU" class="wolai-block wolai-text"><div><span class="inline-wrap">Protocol size： 协议地址大小，标识<span class="jill"></span>IP<span class="jill"></span>地址长度，这里是<span class="jill"></span>4<span class="jill"></span>个字节（32bit）</span></div></div><div id="7bjyqqfhyds828frjW9n1M" class="wolai-block wolai-text"><div><span class="inline-wrap">Opcode： 操作代码，标识<span class="jill"></span>ARP<span class="jill"></span>数据包类型，1<span class="jill"></span>表示请求，2<span class="jill"></span>表示回应</span></div></div><div id="bQ242ai664Yv17ip5xFfpx" class="wolai-block wolai-text"><div><span class="inline-wrap">Sender MAC address ：发送者<span class="jill"></span>MAC</span></div></div><div id="dBogTfSQPManUDbgy951Db" class="wolai-block wolai-text"><div><span class="inline-wrap">Sender IP address ：发送者<span class="jill"></span>IP</span></div></div><div id="7sdF5KHYy3J3kG83K69SHJ" class="wolai-block wolai-text"><div><span class="inline-wrap">Target MAC address ：目标<span class="jill"></span>MAC，此处全<span class="jill"></span>0<span class="jill"></span>表示在请求</span></div></div><div id="pGghvBNAMnWWyYv9CRrisJ" class="wolai-block wolai-text"><div><span class="inline-wrap">Target IP address： 目标<span class="jill"></span>IP</span></div></div><h2 id="nY1q8rsYpnJ8rs1d5NdQE9" class="wolai-block"><span class="inline-wrap"><b>五、ARP<span class="jill"></span>到底是链路层还是网络层？</b></span></h2><div id="6MpjetSvcs9i5sGkgqaUsf" class="wolai-block wolai-text"><div><span class="inline-wrap">这个问题的难度堪比另外一个世界级难题：世界上最好的编程语言是什么？</span></div></div><div id="mVC3dJeAzCGTAS2Ps2GrPq" class="wolai-block wolai-text"><div><span class="inline-wrap">其实早在<span class="jill"></span>20<span class="jill"></span>世纪时，W.Richard Stevens<span class="jill"></span>在《TCP/IP<span class="jill"></span>详解卷一》里面就提到了这个难题。这里给出我个人的协议分层思路，给大家作为参考=&gt;</span></div></div><div id="rKQMkxqTHCc1VWGx4nprn4" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>协议到底所属哪一层，可以从应用/功能来考虑，也可以从层次/包封装来考虑。</b></span><span class="inline-wrap"> </span></div></div><div id="pSNtohemqEZcv1h2rxWTM2" class="wolai-block wolai-text"><div><span class="inline-wrap">以<span class="jill"></span>ARP<span class="jill"></span>协议为例，它的功能最终是获取到<span class="jill"></span>MAC<span class="jill"></span>信息，服务于链路层，从这点考虑，ARP<span class="jill"></span>是链路层协议；但是从层次来看，ARP<span class="jill"></span>基于<span class="jill"></span>Ethernet<span class="jill"></span>协议，IP<span class="jill"></span>协议基于<span class="jill"></span>Ethernet<span class="jill"></span>协议，它们在<span class="jill"></span>Ethernet<span class="jill"></span>协议里面有独立的<span class="jill"></span>Type<span class="jill"></span>类型，前者是<span class="jill"></span>0x0806，后者是<span class="jill"></span>0x0800，既然<span class="jill"></span>ARP<span class="jill"></span>和<span class="jill"></span>IP<span class="jill"></span>协议&quot;平起平坐&quot;，那么<span class="jill"></span>IP<span class="jill"></span>是网络层，ARP<span class="jill"></span>难道就不是网络层？</span></div></div><div id="9yNujTqmN3stVRrfcHup7t" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://pic4.zhimg.com/v2-b62d2021da948c7626cbeafb7ab4e2b3_b.jpg" style="width: 1052.8px"/></figure></div><div id="32CiXrzB2UpL2G8Cjz3Y2o" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>小结：</b></span><span class="inline-wrap"> 基于功能来考虑，ARP<span class="jill"></span>是链路层协议；基于分层/包封装来考虑，ARP<span class="jill"></span>是网络层协议。（此方法对于<span class="jill"></span>ICMP<span class="jill"></span>协议同样管用）</span></div></div><div id="5EFhcsNs1DzzHw9AcFw9XM" class="wolai-block wolai-text"><div><span class="inline-wrap">\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-</span></div></div><div id="cy2Q5WNg61skPRjiLCCZwZ" class="wolai-block wolai-text"><div><span class="inline-wrap">新浪微博：</span><span class="inline-wrap"><a href="https://link.zhihu.com/?target=http%3A//www.weibo.com/jaykingchen"><span>@<span class="jill"></span>拼客学院陈鑫杰</span></a></span></div></div><div id="2yV57bLmwKZFeHKTwSwTX" class="wolai-block wolai-text"><div><span class="inline-wrap">微信公众号：拼客院长陈鑫杰</span></div></div><div id="mnVJPHYkmE54UYN281BiAr" class="wolai-block wolai-text"><div><span class="inline-wrap">拼客学院：</span><span class="inline-wrap"><a href="https://link.zhihu.com/?target=http%3A//www.pinginglab.net/"><span>www.pinginglab.net</span></a></span></div></div></article><footer></footer></body></html>