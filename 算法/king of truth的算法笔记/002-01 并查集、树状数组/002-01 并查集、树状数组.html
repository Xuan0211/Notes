<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>002-01 并查集、树状数组 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="002-01 并查集、树状数组" class="main-title"></div></div></header><article><h2 id="6QLZQL8XX5EGP2qd47EmK6" class="wolai-block"><span class="inline-wrap">并查集</span></h2><h3 id="egDMZE77MPpoAQiX7YoUtA" class="wolai-block"><span class="inline-wrap">基本操作</span></h3><ul class="wolai-block"><li id="qJBapZpioS24CCWj7iyvod"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">查找<span class="jill"></span>Find</span></li><li id="9megE2nhtKGBuYueq3EJjc"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">合并<span class="jill"></span>Union</span></li></ul><hr id="kEsSiYA9kZB5v3XE18nte3" class="wolai-block"/><h3 id="szqeUtvzXpy8dCVYLEXvoB" class="wolai-block"><span class="inline-wrap">初始化</span></h3><code-block id="cxiaAxNwqMbwLXGn8TJqYx" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre><span class="token keyword">void</span> <span class="token function">makeset</span><span class="token punctuation">(</span><span class="token parameter">int size</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword control-flow">for</span><span class="token punctuation">(</span>int i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><hr id="6JQbH56moqYydwu4WSLpLd" class="wolai-block"/><h3 id="jQpugrN7WztvUDNAzPucVR" class="wolai-block"><span class="inline-wrap">查找</span></h3><code-block id="9oMTavSrgP9LwaBHLZ7xnB" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre>int f<span class="token punctuation">[</span><span class="token constant">MAXN</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//递归</span>
int <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">int x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>x<span class="token operator">==</span>f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">return</span> x<span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span>
        <span class="token keyword control-flow">return</span> <span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//非递归</span>
int <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">int x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword control-flow">while</span><span class="token punctuation">(</span>x<span class="token operator">!=</span>f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
        x<span class="token operator">=</span>f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 id="v3tXSyBKp3XZPYjEt3w26A" class="wolai-block"><span class="inline-wrap">路径压缩</span></h4><code-block id="hYcHYHmjC1FZGH5hs7aMcd" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre>int <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">int x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>x<span class="token operator">!=</span>f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
        f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//一定注意这里是f[x]，是递归最外层，不然就是原来的数</span>
<span class="token punctuation">}</span></pre></div></code-block><hr id="hN1ieZVWZHw6jW6bEzQFN7" class="wolai-block"/><h3 id="5KNrsXFDbxcscEzPNfpDnb" class="wolai-block"><span class="inline-wrap">合并</span></h3><code-block id="7xL3piL1imuas5NNnZ4jCq" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre><span class="token keyword">void</span> <span class="token function">unionset</span><span class="token punctuation">(</span><span class="token parameter">int x<span class="token punctuation">,</span>int y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    int xx<span class="token operator">=</span><span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>yy<span class="token operator">=</span><span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>xx<span class="token operator">==</span>yy<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span>
        f<span class="token punctuation">[</span>xx<span class="token punctuation">]</span><span class="token operator">=</span>yy<span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 id="iU92rH5ntARoXok7ssnsGK" class="wolai-block"><span class="inline-wrap">按秩合并</span></h4><code-block id="s3sCQZAfeSsfFT3mJarHdm" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre>std<span class="token operator">:</span><span class="token operator">:</span>vector<span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token function">size</span><span class="token punctuation">(</span><span class="token constant">N</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">unionset</span><span class="token punctuation">(</span><span class="token parameter">int x<span class="token punctuation">,</span>int y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    int xx<span class="token operator">=</span><span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>yy<span class="token operator">=</span><span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>size<span class="token punctuation">[</span>xx<span class="token punctuation">]</span><span class="token operator">></span>size<span class="token punctuation">[</span>yy<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        f<span class="token punctuation">[</span>yy<span class="token punctuation">]</span><span class="token operator">=</span>xx<span class="token punctuation">;</span>
        size<span class="token punctuation">[</span>xx<span class="token punctuation">]</span><span class="token operator">+=</span>size<span class="token punctuation">[</span>yy<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span><span class="token punctuation">{</span>
        f<span class="token punctuation">[</span>xx<span class="token punctuation">]</span><span class="token operator">=</span>yy<span class="token punctuation">;</span>
        size<span class="token punctuation">[</span>yy<span class="token punctuation">]</span><span class="token operator">+=</span>size<span class="token punctuation">[</span>xx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><hr id="wev6mWgP82nrmFqZTv1Pmk" class="wolai-block"/><h3 id="vf43oGqv7w5hdNW7LKiWG1" class="wolai-block"><span class="inline-wrap">例题</span></h3><blockquote id="xgfrUX8F3hUGzcLqtmmuvs" class="wolai-block"><span class="inline-wrap"><a href="https://uoj.ac/problem/127#"><span>
好评</span></a></span><span class="inline-wrap"><a href="https://uoj.ac/problem/127#"><span>差评</span></a></span><span class="inline-wrap">[</span><span class="inline-wrap"><b>+139</b></span><span class="inline-wrap">]</span></blockquote><h1 id="gsS5zcEEXprpgRf4Ux86ZN" class="wolai-block"><span class="inline-wrap">#127. 【NOI2015】程序自动分析</span></h1><blockquote id="nVKrwhRjEY4ddNT1a2NNgu" class="wolai-block"><span class="inline-wrap"><a href="https://uoj.ac/download/problem/127/attachment.zip"><span> 附件下载</span></a></span><span class="inline-wrap"> </span><span class="inline-wrap"><a href="https://uoj.ac/problem/127/statistics"><span> 统计</span></a></span></blockquote><ul class="wolai-block"><li id="hRZ9otmyjNWtnYqXzGo2NM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://uoj.ac/problem/127#tab-statement"><span> 描述</span></a></span></li><li id="r4WNfe718A24ES278ybZpi"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://uoj.ac/problem/127#tab-submit-answer"><span> 提交</span></a></span></li><li id="jz6e9mSp13axBbAbTxKgPw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://uoj.ac/problem/127#tab-custom-test"><span> 自定义测试</span></a></span></li></ul><blockquote id="s8BKRpic4nWrQMTtmm5XB6" class="wolai-block"><span class="inline-wrap">在实现程序自动分析的过程中，常常需要判定一些约束条件是否能被同时满足。</span></blockquote><blockquote id="eLWjL9JM6BgUUuF6VvZ9q7" class="wolai-block"><span class="inline-wrap">考虑一个约束满足问题的简化版本：假设 x1,x2,x3,…x1,x2,x3,… 代表程序中出现的变量，给定 nn 个形如 xi=xjxi=xj 或 xi≠xjxi≠xj 的变量相等/不等的约束条件，请判定是否可以分别为每一个变量赋予恰当的值，使得上述所有约束条件同时被满足。例如，一个问题中的约束条件为：x1=x2x1=x2，x2=x3x2=x3，x3=x4x3=x4，x1≠x4x1≠x4，这些约束条件显然是不可能同时被满足的，因此这个问题应判定为不可被满足。</span></blockquote><blockquote id="dkxjj8UAeLFtAK8hqy2EFj" class="wolai-block"><span class="inline-wrap">现在给出一些约束满足问题，请分别对它们进行判定。</span></blockquote><h3 id="31GPqQT4LS5Y94rF3cpqNZ" class="wolai-block"><span class="inline-wrap">输入格式</span></h3><blockquote id="48qsWyvjng3cTsME7svzEr" class="wolai-block"><span class="inline-wrap">输入文件的第 11 行包含 11 个正整数 tt，表示需要判定的问题个数。注意这些问题之间是相互独立的。</span></blockquote><blockquote id="6YuuDJ9vAfHn5oneAJdPTR" class="wolai-block"><span class="inline-wrap">对于每个问题，包含若干行：</span></blockquote><blockquote id="c7q78d9P5sTSPpXVSvcJcY" class="wolai-block"><span class="inline-wrap">第 11 行包含 11 个正整数 nn，表示该问题中需要被满足的约束条件个数。</span></blockquote><blockquote id="arypx1YEEQHo2PvdRo5taV" class="wolai-block"><span class="inline-wrap">接下来 nn 行，每行包括 33 个整数 i,j,ei,j,e，描述 11 个相等/不等的约束条件，相邻整数之间用单个空格隔开。若 e=1e=1，则该约束条件为 xi=xjxi=xj；若 e=0e=0，则该约束条件为 xi≠xjxi≠xj。</span></blockquote><h3 id="2zcUSPVKys7xR2LDWqsouK" class="wolai-block"><span class="inline-wrap">输出格式</span></h3><blockquote id="vzgaXJJ95GzeY4hrgUurf1" class="wolai-block"><span class="inline-wrap">输出文件包括 tt 行。</span></blockquote><blockquote id="iUMyNemJoJY6S7Xt5dsXa2" class="wolai-block"><span class="inline-wrap">输出文件的第 kk 行输出一个字符串 “YES” 或者 “NO”（不包含引号，字母全部大写），“YES” 表示输入中的第 kk 个问题判定为可以被满足，“NO” 表示不可被满足。</span></blockquote><h3 id="gRkTswVrzt1wKWhBMCtssr" class="wolai-block"><span class="inline-wrap">样例一</span></h3><h4 id="wUVt4J2vXzjDCjTAxSDWev" class="wolai-block"><span class="inline-wrap">input</span></h4><code-block id="imZQdVYXb7vkGfEUcxiHNc" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token number">2</span>
<span class="token number">2</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">1</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">0</span>
<span class="token number">2</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">1</span>
<span class="token number">2</span> <span class="token number">1</span> <span class="token number">1</span></pre></div></code-block><h4 id="tfAk7Wkx6TdX43dE1hr4KM" class="wolai-block"><span class="inline-wrap">output</span></h4><code-block id="syH3REb75sT7bHELKkWoqu" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">NO</span>
<span class="token constant">YES</span></pre></div></code-block><h4 id="q1nVLjyYcYvgxo1YoJpZ9F" class="wolai-block"><span class="inline-wrap">explanation</span></h4><blockquote id="aja3QhN95WgbYyoPrHuNo1" class="wolai-block"><span class="inline-wrap">在第一个问题中，约束条件为：x1=x2,x1≠x2x1=x2,x1≠x2。这两个约束条件互相矛盾，因此不可被同时满足。</span></blockquote><blockquote id="an3tjz6DQwqtzEQfFf24ks" class="wolai-block"><span class="inline-wrap">在第二个问题中，约束条件为：x1=x2,x2=x1x1=x2,x2=x1。这两个约束条件是等价的，可以被同时满足。</span></blockquote><h3 id="3GxYzEdz6SYuoVR5mpMhEj" class="wolai-block"><span class="inline-wrap">样例二</span></h3><h4 id="eKudcg1kMTJEb4zUcKVGV9" class="wolai-block"><span class="inline-wrap">input</span></h4><code-block id="6GqCQ6kgFnFtdptBSkadjB" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">1</span>
<span class="token number">2</span> <span class="token number">3</span> <span class="token number">1</span>
<span class="token number">3</span> <span class="token number">1</span> <span class="token number">1</span>
<span class="token number">4</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">1</span>
<span class="token number">2</span> <span class="token number">3</span> <span class="token number">1</span>
<span class="token number">3</span> <span class="token number">4</span> <span class="token number">1</span>
<span class="token number">1</span> <span class="token number">4</span> <span class="token number">0</span></pre></div></code-block><h4 id="uvUBo88opardygaRz5GeaN" class="wolai-block"><span class="inline-wrap">output</span></h4><code-block id="w1GQz9jVicTMiBAaCCmVWk" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">YES</span>
<span class="token constant">NO</span></pre></div></code-block><h4 id="sAJfYbFq2pbzmAzTWzyPjK" class="wolai-block"><span class="inline-wrap">explanation</span></h4><blockquote id="s9szq2dBXqFAWjRRFVmMoY" class="wolai-block"><span class="inline-wrap">在第一个问题中，约束条件有三个：x1=x2x1=x2，x2=x3x2=x3，x3=x1x3=x1。只需赋值使得 x1=x2=x3x1=x2=x3，即可同时满足所有的约束条件。</span></blockquote><blockquote id="pxURh4JrfA4ooE7or3vk5A" class="wolai-block"><span class="inline-wrap">在第二个问题中，约束条件有四个：x1=x2x1=x2，x2=x3x2=x3，x3=x4x3=x4，x1≠x4x1≠x4。由前三个约束条件可以推出 x1=x2=x3=x4x1=x2=x3=x4，然而最后一个约束条件却要求 x1≠x4x1≠x4，因此不可被满足。</span></blockquote><h3 id="rS5wFNzQ6fP9pg3GMFtgem" class="wolai-block"><span class="inline-wrap">样例三</span></h3><blockquote id="1p2nH4UkeT4wo6e5NYy8ec" class="wolai-block"><span class="inline-wrap">见样例数据下载。</span></blockquote><h3 id="eEYiuuy3ewShK9DqV537M6" class="wolai-block"><span class="inline-wrap">限制与约定</span></h3><div id="acFCQf7d6oqdSneatCiaHr" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 185px"><span class="inline-wrap">测试点编号</span></th><th style="width: 185px"><span class="inline-wrap">nn 的规模</span></th><th style="width: 185px"><span class="inline-wrap">i,ji,j 的规模</span></th><th style="width: 185px"><span class="inline-wrap">约定</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">1</span></td><td><span class="inline-wrap">1≤n≤101≤n≤10</span></td><td><span class="inline-wrap">1≤i,j≤100001≤i,j≤10000</span></td><td><span class="inline-wrap">1≤t≤101≤t≤10，e∈{0,1}e∈{0,1}</span></td></tr><tr><td><span class="inline-wrap">2</span></td><td><br/></td><td><br/></td><td><br/></td></tr><tr><td><span class="inline-wrap">3</span></td><td><span class="inline-wrap">1≤n≤1001≤n≤100</span></td><td><br/></td><td><br/></td></tr><tr><td><span class="inline-wrap">4</span></td><td><br/></td><td><br/></td><td><br/></td></tr><tr><td><span class="inline-wrap">5</span></td><td><span class="inline-wrap">1≤n≤1000001≤n≤100000</span></td><td><br/></td><td><br/></td></tr><tr><td><span class="inline-wrap">6</span></td><td><br/></td><td><br/></td><td><br/></td></tr><tr><td><span class="inline-wrap">7</span></td><td><br/></td><td><br/></td><td><br/></td></tr><tr><td><span class="inline-wrap">8</span></td><td><span class="inline-wrap">1≤n≤1000001≤n≤100000</span></td><td><span class="inline-wrap">1≤i,j≤10000000001≤i,j≤1000000000</span></td><td><br/></td></tr><tr><td><span class="inline-wrap">9</span></td><td><br/></td><td><br/></td><td><br/></td></tr><tr><td><span class="inline-wrap">10</span></td><td><br/></td><td><br/></td><td><br/></td></tr></tbody></table></div><blockquote id="ixbtjEPSeCdK1XRFb7PXsn" class="wolai-block"><span class="inline-wrap"><b>时间限制：</b></span><span class="inline-wrap"> 2s2s</span></blockquote><blockquote id="gVguH2eEcse4qwWHykAcfn" class="wolai-block"><span class="inline-wrap"><b>空间限制：</b></span><span class="inline-wrap"> 512MB512MB</span></blockquote><h3 id="4vfiVXKY1w3wBGHYqvFtiD" class="wolai-block"><span class="inline-wrap">下载</span></h3><blockquote id="8c6QHtWX5EPNjXwJYGnmZ2" class="wolai-block"><span class="inline-wrap"><a href="https://uoj.ac/download.php?type=problem&amp;id=127"><span>样例数据下载</span></a></span></blockquote><div id="4TaQ78oVY4G6spYTYZZvFD" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>==把所有<span class="jill"></span>e=1<span class="jill"></span>的操作放在前面，然后再进行<span class="jill"></span>e=0<span class="jill"></span>的操作==</b></span></div></div><div id="ugv5YUSFu4aGryvfD3eez5" class="wolai-block wolai-text"><div><span class="inline-wrap">天啊你怎么这么傻啊来一个判断一个！！！可以整合后一起判断的，反正我只要知道整体是否满足就行了！！！</span></div></div><div id="gxemXZsQTvGPNcWfvBQKy2" class="wolai-block wolai-text"><div><span class="inline-wrap">怎么这么蠢啊啊啊啊啊！！！！！</span></div></div><code-block id="dAH9YX5xCdcq6kMhP5RWnv" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre>#include<span class="token operator">&lt;</span>iostream<span class="token operator">></span>
#include<span class="token operator">&lt;</span>cstdio<span class="token operator">></span>
#include<span class="token operator">&lt;</span>cstdlib<span class="token operator">></span>
#include<span class="token operator">&lt;</span>vector<span class="token operator">></span>
#include<span class="token operator">&lt;</span>stack<span class="token operator">></span>
using namespace std<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">makeset</span><span class="token punctuation">(</span><span class="token parameter">int<span class="token operator">*</span> f<span class="token punctuation">,</span> int size</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

int <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">int <span class="token operator">*</span>f<span class="token punctuation">,</span>int x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
    f<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">unionset</span><span class="token punctuation">(</span><span class="token parameter">int<span class="token operator">*</span> f<span class="token punctuation">,</span> int i<span class="token punctuation">,</span> int j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  int fi <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> fj <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
  f<span class="token punctuation">[</span>fi<span class="token punctuation">]</span> <span class="token operator">=</span> fj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

int <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  int t<span class="token punctuation">;</span>
  cin <span class="token operator">>></span> t<span class="token punctuation">;</span>
  <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span>t<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    int n<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j <span class="token punctuation">,</span>e<span class="token punctuation">;</span>
    cin <span class="token operator">>></span> n<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>int<span class="token operator">>></span> same<span class="token punctuation">;</span>
    int f<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">makeset</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cin <span class="token operator">>></span> i <span class="token operator">>></span> j <span class="token operator">>></span> e<span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        vector<span class="token operator">&lt;</span>int<span class="token operator">></span> command<span class="token punctuation">;</span>
        command<span class="token punctuation">.</span><span class="token method function property-access">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        command<span class="token punctuation">.</span><span class="token method function property-access">push_back</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        same<span class="token punctuation">.</span><span class="token method function property-access">push_back</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">else</span>
      <span class="token punctuation">{</span>
        <span class="token function">unionset</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    int k <span class="token operator">=</span> same<span class="token punctuation">.</span><span class="token method function property-access">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    int flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> k<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      int x <span class="token operator">=</span> same<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> same<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      int xx <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> yy <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"NO\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"YES\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h2 id="fYhHB3gmLeSGGpMExgEKnk" class="wolai-block"><span class="inline-wrap">树状数组</span></h2><h3 id="aJVDz7GTWjtVTKxrBavPB9" class="wolai-block"><span class="inline-wrap">简介</span></h3><div id="9ZzdgmRVoG6jQQjDE8C7hE" class="wolai-block wolai-text"><div><span class="inline-wrap">解决单点修改</span></div></div><div id="84nVqAEhC5jfYyMaxTEd2K" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="D:/Typora-images/typora-user-images/image-20220905161421080.png" alt="image-20220905161421080"/><figcaption>image-20220905161421080</figcaption></figure></div><ul class="wolai-block"><li id="vHewW5WAJPiYTjyQohAnU4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">a 的树状数组，求出来是<span class="jill"></span>sum(a)</span></li><li id="qraKk85toChRzjfUjFSmCj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">差分数组<span class="jill"></span>b<span class="jill"></span>的树状数组，求出来是 a</span></li></ul><hr id="8LMnkMiQZ8DVgXrHZAHaq2" class="wolai-block"/><h3 id="1XC7wNG5xcG6NSKBopoKtk" class="wolai-block"><span class="inline-wrap">用法和操作</span></h3><h4 id="etsP5ULPqXaidZko8mzdBP" class="wolai-block"><span class="inline-wrap">lowbit<span class="jill"></span>函数</span></h4><code-block id="7PEfZugdTtD8TRUSuriKiP" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre>int <span class="token function">lowbit</span><span class="token punctuation">(</span><span class="token parameter">int x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> x<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 id="6SNUScqMfZVdCZ8oaSJN8j" class="wolai-block"><span class="inline-wrap">Add</span></h4><code-block id="txV2zBPX6jWwDxfcN94JAg" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre><span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">int x<span class="token punctuation">,</span>int k</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword control-flow">while</span><span class="token punctuation">(</span>x<span class="token operator">&lt;=</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>
        c<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">+=</span>k<span class="token punctuation">;</span>
        x<span class="token operator">+=</span><span class="token function">lowbit</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 id="ooazToprWFMmMS1LaETx7b" class="wolai-block"><span class="inline-wrap">getsum</span></h4><code-block id="eQY3bCMmCKTJh9G1KGWqWU" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre>int <span class="token function">getsum</span><span class="token punctuation">(</span>int x<span class="token punctuation">)</span><span class="token comment">//a[1]到a[x]的和</span>
<span class="token punctuation">{</span>
    int sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">while</span><span class="token punctuation">(</span>x<span class="token operator">>=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        sum<span class="token operator">+=</span>c<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
        x<span class="token operator">-=</span><span class="token function">lowbit</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><hr id="24e3ceUfT7D8XFDNeXhPPi" class="wolai-block"/><h3 id="2UytRLDGJVemB8SGRmaZdR" class="wolai-block"><span class="inline-wrap">区间加&amp;区间求和</span></h3><div id="6gjaecxSxZAEncjE8gtoV2" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>区间加--差分数组</b></span></div></div><div id="sFe7zpT8P1JzFD7mKQ74d5" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>==a<span class="jill"></span>有差分数组<span class="jill"></span>b，求<span class="jill"></span>a=求<span class="jill"></span>b<span class="jill"></span>的前缀和==</b></span></div></div><div id="k9TrumKUgd6TP4FvQX6KEE" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="D:%5CTypora-images%5Ctypora-user-images%5Cimage-20220905160657919.png" alt="image-20220905160657919"/><figcaption>image-20220905160657919</figcaption></figure></div><div id="39xv75jnfv4aQ1juveXvte" class="wolai-block wolai-text"><div><span class="inline-wrap">区间和=两个前缀和相减，用两个树状数组维护红框。</span></div></div><div id="nAPqCEGbGeSAwf8dAPrG9r" class="wolai-block wolai-text"><div><span class="inline-wrap">有差分数组<span class="jill"></span>b<span class="jill"></span>后，需要将<span class="jill"></span>a[l]...a[r]内的值加<span class="jill"></span>k，则只需修改两个值：b[l] + k, b[r+1]-k</span></div></div><div id="oyRffuxcJVsAnDqF7FXqvF" class="wolai-block wolai-text"><div><span class="inline-wrap">b[i] 记录 a[i]和<span class="jill"></span>a[i-1]的距离</span></div></div><div id="qgUrZBEboeh6THj2HBoZjp" class="wolai-block wolai-text"><div><span class="inline-wrap">t1 和 t2 分别为两个红框的 树状数组</span></div></div><code-block id="hJLbTBDF7ZBbKFLWDm9oJL" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre>int t1<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">,</span>t2<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">,</span>n<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>int x<span class="token punctuation">,</span>int k<span class="token punctuation">)</span><span class="token comment">//只修改b[l]后树状数组的操作</span>
<span class="token punctuation">{</span>
    int k1<span class="token operator">=</span>x<span class="token operator">*</span>k<span class="token punctuation">;</span>
    <span class="token keyword control-flow">while</span><span class="token punctuation">(</span>x<span class="token operator">&lt;=</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>
        t1<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">+=</span>k<span class="token punctuation">;</span>
        t2<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">+=</span>k1<span class="token punctuation">;</span>
        x<span class="token operator">+=</span><span class="token function">lowbit</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

int <span class="token function">getsum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">,</span>int <span class="token operator">*</span>t<span class="token punctuation">,</span>int x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    int sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">while</span><span class="token punctuation">(</span>x<span class="token operator">>=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        sum<span class="token operator">+=</span>t<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
        x<span class="token operator">-=</span><span class="token function">lowbit</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token parameter">int l<span class="token punctuation">,</span>int r<span class="token punctuation">,</span>int k</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">add</span><span class="token punctuation">(</span>r<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

int <span class="token function">getsum1</span><span class="token punctuation">(</span><span class="token parameter">int l<span class="token punctuation">,</span>int r</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> 
        <span class="token punctuation">(</span> r <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">getsum</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-</span> l <span class="token operator">*</span> <span class="token function">getsum</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> l<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
        <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token function">getsum</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getsum</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> l<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><hr id="52NbYEoMzxhrkG5yj4822j" class="wolai-block"/><h3 id="k3Yumf4JHFPNHGNqcq9PbD" class="wolai-block"><span class="inline-wrap">Tricks</span></h3><h4 id="cV4PgckLWb2bFP2am42Ax2" class="wolai-block"><span class="inline-wrap">O(n)建树</span></h4><div id="edtQTSbL1AvjFLQD8pCaMW" class="wolai-block wolai-text"><div><span class="inline-wrap">用儿子更新父亲</span></div></div><code-block id="1k2WRv8fPAQFzER9YE3nVK" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre><span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword control-flow">for</span><span class="token punctuation">(</span>int i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        int j<span class="token operator">=</span>i<span class="token operator">+</span><span class="token function">lowbit</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>j<span class="token operator">&lt;=</span>n<span class="token punctuation">)</span><span class="token comment">//是if不是while，因为父亲的值是由直接相连的儿子求和得到，如果用while那路径上有几个节点就会被加多少遍</span>
            t<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">+=</span>t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><hr id="muiCnpEJytgcpDWWnTLFAX" class="wolai-block"/><h3 id="w77XXtQpMiFGp3cEW8qoDG" class="wolai-block"><span class="inline-wrap">二维</span></h3><div id="kmjrmBqgcEYr8o3oD7pYES" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="D:/Typora-images/typora-user-images/image-20220907124319210.png" alt="image-20220907124319210"/><figcaption>image-20220907124319210</figcaption></figure></div><div id="kJdwe6q95YoLGp2Py4r4kS" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>s[x,y]  代表  矩形(x,y)区域上  所有<span class="jill"></span>d[i,j] 的和</b></span></div></div><div id="1piQSzq2a9uMkDx74zT2JW" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="D:/Typora-images/typora-user-images/image-20220907124451243.png" alt="image-20220907124451243"/><figcaption>image-20220907124451243</figcaption></figure></div><h3 id="jt17SuFWBsB3pyRUh4NygF" class="wolai-block"><span class="inline-wrap">例题</span></h3><h1 id="gR9FYQWVDRibhQdvCjNtHs" class="wolai-block"><span class="inline-wrap">#132. 树状数组 3 ：区间修改，区间查询</span></h1><blockquote id="osP8U5KDinbtpDv2gFt5dh" class="wolai-block"><span class="inline-wrap">传统</span></blockquote><blockquote id="pCQ9aJJzJ66BKeorgsboQu" class="wolai-block"><span class="inline-wrap">1500 ms</span></blockquote><blockquote id="kvfq8Dua83ouX4kumhKoLJ" class="wolai-block"><span class="inline-wrap">256 MiB</span></blockquote><blockquote id="fBwYi1NLR4tuytsu7TkGsw" class="wolai-block"><span class="inline-wrap">显示标签</span></blockquote><blockquote id="4Q6z2j5wFVdFXyDfx67RS4" class="wolai-block"><span class="inline-wrap">4743</span></blockquote><blockquote id="ahepxRbqobSJVxp4QRz3N8" class="wolai-block"><span class="inline-wrap">通过</span></blockquote><blockquote id="buumYQNx7P2F5hLqrsS9aD" class="wolai-block"><span class="inline-wrap">12511</span></blockquote><blockquote id="gEq6S47tDGZobSMr24wbNo" class="wolai-block"><span class="inline-wrap">提交</span></blockquote><blockquote id="1tnz3Fc8XSj2u4D4uw8zqE" class="wolai-block"><span class="inline-wrap">题目描述</span></blockquote><blockquote id="8otoYMg95zJckVW76nu4Bv" class="wolai-block"><span class="inline-wrap">这是一道模板题。</span></blockquote><blockquote id="bzVD4ucUqKv1mffqnE7szH" class="wolai-block"><span class="inline-wrap">给定数列 a[1], a[2], \dots, a[n]，你需要依次进行 q 个操作，操作有两类：</span></blockquote><ul class="wolai-block"><li id="vBh5nSK86uBMarEdBkeZso"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>1 l r x</code></span><span class="inline-wrap">：给定 l,r,x，对于所有 i\in[l,r]，将 a[i] 加上 x（换言之，将 a[l], a[l+1], \dots, a[r] 分别加上 x）；</span></li><li id="98JubH3Zvd8JscMkwnRy73"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>2 l r</code></span><span class="inline-wrap">：给定 l,r，求 \sum _{i=l}^ra[i] 的值（换言之，求 a[l]+a[l+1]+\dots+a[r] 的值）。</span></li></ul><blockquote id="fK9hMeZ5GiZGzURokSzwar" class="wolai-block"><span class="inline-wrap">输入格式</span></blockquote><blockquote id="jnXczn8JeCiGmKdc43CNJr" class="wolai-block"><span class="inline-wrap">第一行包含 2 个正整数 n,q，表示数列长度和询问个数。保证 1\le n,q\le 10^6。
第二行 n 个整数 a[1],a[2],\dots,a[n]，表示初始数列。保证 |a[i]|\le 10^6。
接下来 q 行，每行一个操作，为以下两种之一：</span></blockquote><ul class="wolai-block"><li id="hsmKwjApotMYkvsnja2TjD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>1 l r x</code></span><span class="inline-wrap">：对于所有 i\in[l,r]，将 a[i] 加上 x；</span></li><li id="rRCofLuNfTauTkH3MJgoz6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>2 l r</code></span><span class="inline-wrap">：输出 \sum _{i=l}^ra[i] 的值。</span></li></ul><blockquote id="pxn3nhApuRrpktEtonsCZg" class="wolai-block"><span class="inline-wrap">保证 1\le l\le r\le n, |x|\le 10^6。</span></blockquote><blockquote id="bHmNJwVkLJvgm4VCG5zv4N" class="wolai-block"><span class="inline-wrap">输出格式</span></blockquote><blockquote id="nw8JqKAhr5cVaURgsfVTXJ" class="wolai-block"><span class="inline-wrap">对于每个 </span><span class="inline-wrap"><code>2 l r</code></span><span class="inline-wrap"> 操作，输出一行，每行有一个整数，表示所求的结果。</span></blockquote><blockquote id="5e1iHFC1EaPrQURmFgUnVt" class="wolai-block"><span class="inline-wrap">样例</span></blockquote><blockquote id="k2vo7Hjdv7qwbQ8DmGPQzS" class="wolai-block"><span class="inline-wrap">输入已复制</span></blockquote><code-block id="sH2DVa99ByCgo1AZypnDkP" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token number">5</span> <span class="token number">10</span>
<span class="token number">2</span> <span class="token number">6</span> <span class="token number">6</span> <span class="token number">1</span> <span class="token number">1</span>
<span class="token number">2</span> <span class="token number">1</span> <span class="token number">4</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">5</span> <span class="token number">10</span>
<span class="token number">2</span> <span class="token number">1</span> <span class="token number">3</span>
<span class="token number">2</span> <span class="token number">2</span> <span class="token number">3</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">8</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">7</span>
<span class="token number">1</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">10</span>
<span class="token number">2</span> <span class="token number">1</span> <span class="token number">2</span>
<span class="token number">1</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span>
<span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span></pre></div></code-block><blockquote id="f6ntm1PnFBRMyqsaCdYdxa" class="wolai-block"><span class="inline-wrap">输出复制</span></blockquote><code-block id="hJnxmgbmEq8cZMaStLnaCb" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token number">15</span>
<span class="token number">34</span>
<span class="token number">32</span>
<span class="token number">33</span>
<span class="token number">50</span></pre></div></code-block><blockquote id="i6yYvJAMVXqHf7CEbLqhah" class="wolai-block"><span class="inline-wrap">数据范围与提示</span></blockquote><blockquote id="dmpUJaAk8gVUyKz9pbXMYH" class="wolai-block"><span class="inline-wrap">对于所有数据，1\le n,q\le 10^6, |a[i]|\le 10^6, 1\le l\le r\le n, |x|\le 10^6。</span></blockquote><code-block id="rY23Rj4v9BMbAFVMhwt4k9" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre>#include<span class="token operator">&lt;</span>cstdio<span class="token operator">></span>
#include<span class="token operator">&lt;</span>cstdlib<span class="token operator">></span>
#include<span class="token operator">&lt;</span>iostream<span class="token operator">></span>
using namespace std<span class="token punctuation">;</span>

int n<span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>b<span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>t1<span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>t2<span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

int <span class="token function">lowbit</span><span class="token punctuation">(</span><span class="token parameter">int x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> x <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">initb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">initt1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    t1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    int j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token function">lowbit</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span> t1<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> t1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">initt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    t2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>i<span class="token punctuation">;</span>
    int j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token function">lowbit</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span> t2<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> t2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">int x<span class="token punctuation">,</span> int k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  int m <span class="token operator">=</span> k <span class="token operator">*</span> x<span class="token punctuation">;</span>
  <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t1<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> k<span class="token punctuation">;</span>
    t2<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> m<span class="token punctuation">;</span>
    x <span class="token operator">+=</span> <span class="token function">lowbit</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

int <span class="token function">getsum</span><span class="token punctuation">(</span><span class="token parameter">int <span class="token operator">*</span>t<span class="token punctuation">,</span>int x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  int sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span>x <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> t<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
    x <span class="token operator">-=</span> <span class="token function">lowbit</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token parameter">int k<span class="token punctuation">,</span>int l<span class="token punctuation">,</span> int r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">add</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">add</span><span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

int <span class="token function">getsum1</span><span class="token punctuation">(</span><span class="token parameter">int l<span class="token punctuation">,</span> int r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">getsum</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-</span> l <span class="token operator">*</span> <span class="token function">getsum</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token function">getsum</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getsum</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

int <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  int q<span class="token punctuation">;</span>
  cin <span class="token operator">>></span> n <span class="token operator">>></span> q<span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    cin <span class="token operator">>></span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">initb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">initt1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">initt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span>q<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    int z<span class="token punctuation">;</span>
    cin <span class="token operator">>></span> z<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>z <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      int l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> x<span class="token punctuation">;</span>
      cin <span class="token operator">>></span> l <span class="token operator">>></span> r <span class="token operator">>></span> x<span class="token punctuation">;</span>
      <span class="token function">add1</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      int l<span class="token punctuation">,</span> r<span class="token punctuation">;</span>
      cin <span class="token operator">>></span> l <span class="token operator">>></span> r<span class="token punctuation">;</span>
      cout<span class="token operator">&lt;&lt;</span><span class="token function">getsum1</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></article><footer></footer></body></html>